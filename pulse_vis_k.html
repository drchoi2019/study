<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>복합맥상의 시각화</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background-color: #f8f7f5;
            color: #383431;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align content to the top */
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        .pulse-btn {
            transition: all 0.2s ease-in-out;
        }
        .pulse-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        /* Custom slider styles */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #8B725A;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #8B725A;
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 5px rgba(0,0,0,0.2);
        }
    </style>
    <header class="w-full max-w-3xl mx-auto px-4 flex justify-between items-center mb-4">
    <a href="index.html" class="text-lg font-serif font-semibold hover:text-gray-500">
        &larr; Interactive TCM
    </a>
</header>
</head>
<body class="bg-gray-50">


    <h1 class="text-2xl md:text-3xl font-bold text-gray-800 mb-8">복합맥상의 시각화</h1>

    <div class="w-full max-w-3xl grid grid-cols-1 md:grid-cols-5 gap-6">
        
        <!-- Left Column: Diagnosis Selection -->
        <div class="md:col-span-2 bg-white/60 backdrop-blur-sm p-3 rounded-2xl shadow-lg border border-gray-200/80">
            <div class="space-y-3">
                <!-- 풍 (Wind) Section -->
                <div class="p-2 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="space-y-2">
                        <div>
                            <span class="font-semibold text-base">풍한 (風寒)</span>
                            <div class="flex flex-wrap gap-1 mt-1"><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"depth":9, "softness":-7, "strength":5}'>부+긴</button><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"depth":9, "speed":-9}'>부+지</button><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"depth":9, "strength":-9}'>부+약</button></div>
                        </div>
                        <div>
                            <span class="font-semibold text-base">풍열 (風熱)</span>
                            <div class="flex flex-wrap gap-1 mt-1"><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"depth":9, "speed":9}'>부+삭</button></div>
                        </div>
                    </div>
                </div>

                <!-- 간 (Liver) Section -->
                <div class="p-2 bg-green-50 border border-green-200 rounded-lg">
                    <div class="space-y-2">
                        <div><span class="font-semibold text-base">간양상항</span><div class="mt-1"><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"softness":-9, "strength":-5}'>현+세</button></div></div>
                        <div><span class="font-semibold text-base">간화상염</span><div class="mt-1"><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"softness":-9, "speed":9}'>현+삭</button></div></div>
                    </div>
                </div>

                <!-- 허 (Deficiency) Section -->
                <div class="p-2 bg-yellow-50 border border-yellow-200 rounded-lg">
                     <div class="space-y-2">
                        <div>
                            <span class="font-semibold text-base">음허 (陰虛)</span>
                            <div class="flex flex-wrap gap-1 mt-1"><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"strength":-5, "speed":9}'>세+삭</button><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"depth":9, "strength":-7}'>부+허</button></div>
                        </div>
                        <div>
                            <span class="font-semibold text-base">양허 (陽虛)</span>
                            <div class="flex flex-wrap gap-1 mt-1"><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"depth":-9, "speed":-9}'>침+지</button><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"depth":-9, "strength":-5}'>침+세</button></div>
                        </div>
                        <div>
                            <span class="font-semibold text-base">혈허 (血虛)</span>
                            <div class="mt-1"><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"strength":-9, "rhythm":-7}'>세+약+삽</button></div>
                        </div>
                    </div>
                </div>
                
                <!-- 실 (Excess) Section -->
                <div class="p-2 bg-red-50 border border-red-200 rounded-lg">
                    <div class="space-y-2">
                        <div><span class="font-semibold text-base">혈어 (血瘀)</span><div class="mt-1"><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"rhythm":-9, "strength":-5}'>삽+세</button></div></div>
                        <div><span class="font-semibold text-base">습열 (濕熱)</span><div class="mt-1"><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"rhythm":9, "speed":9}'>활+삭</button></div></div>
                        <div><span class="font-semibold text-base">습담 (濕痰)</span><div class="mt-1"><button class="pulse-btn text-sm bg-white border border-gray-300 rounded-full px-2 py-0.5" data-pulse='{"softness":9, "rhythm":9}'>유+활</button></div></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Interactive Chart -->
        <div class="md:col-span-3 bg-white/50 backdrop-blur-sm p-4 rounded-2xl shadow-lg border border-gray-200/80">
            <div class="flex flex-col h-full gap-4">
                <div id="controls" class="space-y-2">
                    <!-- Controls are generated dynamically -->
                </div>
                <div class="relative w-full flex-grow">
                    <canvas id="pulseChart"></canvas>
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const controlsContainer = document.getElementById('controls');
            const ctx = document.getElementById('pulseChart').getContext('2d');
            let pulseChart;

            const axes = [
                { id: 'speed', label: '지삭 (속도)', minLabel: '지(遲)', maxLabel: '삭(數)' },
                { id: 'depth', label: '부침 (깊이)', minLabel: '침(沈)', maxLabel: '부(浮)' },
                { id: 'strength', label: '허실 (세기)', minLabel: '허(虛)', maxLabel: '실(實)' },
                { id: 'rhythm', label: '규칙성', minLabel: '삽(澀)', maxLabel: '활(滑)' },
                { id: 'softness', label: '유연함', minLabel: '현/긴(弦/緊)', maxLabel: '유(濡)' }
            ];

            function initializeApp() {
                createControls();
                createChart();
                setupEventListeners();
                updateChart();
            }

            function createControls() {
                controlsContainer.innerHTML = '';
                axes.forEach(axis => {
                    const controlHTML = `
                        <div>
                            <label for="${axis.id}" class="block text-sm font-medium text-gray-700 mb-0.5">${axis.label}</label>
                            <div class="flex items-center space-x-2">
                                <span class="text-sm text-gray-500 w-12 text-right">${axis.minLabel}</span>
                                <input type="range" id="${axis.id}" min="-10" max="10" value="0" class="flex-1 slider">
                                <span class="text-sm text-gray-500 w-12 text-left">${axis.maxLabel}</span>
                            </div>
                        </div>
                    `;
                    controlsContainer.innerHTML += controlHTML;
                });
            }

            function createChart() {
                pulseChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: axes.map(a => a.label.split(' ')[0]), // Show only main label e.g., "부침"
                        datasets: [{
                            label: '현재 맥상',
                            data: axes.map(() => 5),
                            fill: true,
                            backgroundColor: 'rgba(139, 114, 90, 0.2)',
                            borderColor: 'rgb(139, 114, 90)',
                            pointBackgroundColor: 'rgb(139, 114, 90)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgb(139, 114, 90)'
                        }]
                    },
                    options: {
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: { display: true },
                                min: 0,
                                max: 10,
                                ticks: {
                                    display: false, // Hide tick labels (0, 5, 10)
                                    stepSize: 5 
                                },
                                pointLabels: { 
                                    font: { size: 12, weight: '500', family: "'Noto Sans KR', sans-serif" } 
                                }
                            }
                        },
                        plugins: { 
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        // Show full label in tooltip
                                        return axes[context.dataIndex].label;
                                    }
                                }
                            }
                        }
                    }
                });
            }
            
            function updateChart() {
                if (!pulseChart) return;
                const newData = axes.map(axis => {
                    const slider = document.getElementById(axis.id);
                    return slider ? (parseInt(slider.value) + 10) / 2 : 5;
                });
                pulseChart.data.datasets[0].data = newData;
                pulseChart.update('none');
            }

            function setPulsePattern(config) {
                axes.forEach(axis => { document.getElementById(axis.id).value = 0; });
                for (const key in config) {
                    const slider = document.getElementById(key);
                    if (slider) slider.value = config[key];
                }
                updateChart();
            }

            function setupEventListeners() {
                document.querySelectorAll('.slider').forEach(slider => {
                    slider.addEventListener('input', updateChart);
                });
                document.querySelectorAll('.pulse-btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const config = JSON.parse(button.dataset.pulse);
                        setPulsePattern(config);
                    });
                });
            }

            initializeApp();
        });
    </script>
<!-- Footer for Individual Pages -->
<footer class="text-center py-8 mt-12 text-sm text-gray-500">
    <p>&copy; 2024 Hyungsuk Choi. All Rights Reserved.</p>
</footer>
</body>
</html>
