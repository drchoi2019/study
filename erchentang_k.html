<!DOCTYPE html>
<html lang="ko">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QC84KCE6C1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QC84KCE6C1');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>이진탕</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif+KR:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #F7F3EF;
            font-family: 'Noto Sans KR', sans-serif;
            color: #374151; /* text-gray-700 */
            overflow-x: hidden;
        }
        .font-serif {
            font-family: 'Noto Serif KR', serif;
        }
        .visualization-area {
            background-color: #FDFBFA;
            border: 1px solid #EAE3DB;
        }
        .herb-card {
            transition: all 0.25s ease-in-out;
            border: 2px solid transparent;
            background-color: #FFFFFF;
            cursor: pointer;
        }
        .herb-card.active {
            background-color: #EAE3DB;
            border-color: #BCAEA0;
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.07), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        .herb-card:not(.active):hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.07), 0 4px 6px -2px rgba(0,0,0,0.05);
        }
        
        /* --- SVG Animation States --- */
        #clog, #bubbles, #push-effect, #water-flush {
            transition: all 0.7s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #bubbles, #push-effect, #water-flush {
            opacity: 0;
        }
        .ban-xia-active #clog { transform: scale(0.9); opacity: 0.7; filter: blur(1px); }
        .ban-xia-active #bubbles { opacity: 1; }
        .chen-pi-active #clog { transform: translateX(80px) scale(0.8); opacity: 0.5; }
        .chen-pi-active #push-effect { opacity: 1; transform: translateX(40px); }
        .fu-ling-active #clog { transform: translateX(150px) scale(0.4); opacity: 0; }
        .fu-ling-active #water-flush { opacity: 1; transform: scaleX(1); transform-origin: left; }

        /* --- Formula Visualization Styles --- */
        .formula-item {
            background-color: #e9e2d9;
            color: #5a5a5a;
        }
        .formula-item.active {
            background-color: #A67B5B;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .central-orb {
            background: radial-gradient(circle, #A67B5B 0%, #6F5B3E 70%);
            box-shadow: 0 0 20px #C89F76, 0 0 40px #C89F76, inset 0 0 15px #e6c5a8;
        }
        .herb-orb {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            opacity: 0;
            transform: scale(0);
            cursor: pointer;
        }
        .herb-orb:hover {
            transform: scale(1.1) !important;
        }
        .herb-orb.visible { opacity: 1; transform: scale(1); }
        .herb-orb.base {
            background: radial-gradient(circle, #D4A373, #A17C4F);
            box-shadow: 0 0 10px #D4A373, inset 0 0 5px #f3d8b7;
            color: white;
        }
        .herb-orb.added {
            background: radial-gradient(circle, #81A89D, #52796F);
            box-shadow: 0 0 10px #81A89D, inset 0 0 5px #bde0d9;
            color: white;
        }
        .herb-orb.group {
            background: radial-gradient(circle, #A3A8B8, #6B7280); /* Grayish-blue */
            box-shadow: 0 0 10px #A3A8B8, inset 0 0 5px #d1d5db;
            color: white;
        }
        /* Modal styles */
        .modal {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="antialiased flex flex-col min-h-screen">

    <!-- Header -->
<header style="width: 100%; max-width: 48rem; margin: 1rem auto; padding: 0 1rem; display: flex; justify-content: space-between; align-items: center;">
    <a href="index.html" 
       style="font-family: serif; font-size: 1.125rem; font-weight: 600; color: rgb(55, 65, 81); text-decoration: none;">
        &larr; Interactive TCM
    </a>
</header>

    <main class="flex-grow">
        <div class="container mx-auto px-4 py-8 max-w-4xl">
            
            <div class="text-center mb-12">
                <h1 class="text-4xl md:text-5xl font-bold text-gray-800">이진탕</h1>
            </div>

            <!-- Section 1: Drain Analogy -->
            <div class="mb-20">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800 text-center mb-8">이진탕의 작용 원리</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 items-center">
                    <div id="visualization-container" class="visualization-area w-full h-80 rounded-2xl shadow-inner p-4 flex items-center justify-center">
                        <svg viewBox="0 0 200 100" class="w-full h-full">
                            <path d="M 0 20 H 200 V 80 H 0 Z" fill="#D6CDBF" />
                            <path d="M 0 25 H 200 V 75 H 0 Z" fill="#F7F3EF" />
                            <g id="water-flush" style="transform: scaleX(0);"><rect x="0" y="25" width="200" height="50" fill="#60A5FA" fill-opacity="0.5" /></g>
                            <g id="clog">
                                <path d="M 50 40 C 55 30, 70 30, 80 45 C 90 60, 75 70, 60 65 C 45 70, 45 50, 50 40 Z" fill="#A78BFA" opacity="0.8"/>
                                <path d="M 65 35 C 70 30, 85 35, 90 45 C 95 55, 85 65, 75 60 C 65 65, 60 40, 65 35 Z" fill="#A78BFA" opacity="0.7"/>
                            </g>
                            <g id="bubbles">
                                <circle cx="60" cy="45" r="3" fill="#34D399" class="animate-pulse"/>
                                <circle cx="80" cy="55" r="2" fill="#34D399" class="animate-pulse delay-100"/>
                                <circle cx="70" cy="38" r="2.5" fill="#34D399" class="animate-pulse delay-200"/>
                            </g>
                            <g id="push-effect">
                                <path d="M 20 50 L 50 50" stroke="#F97316" stroke-width="3" stroke-linecap="round" />
                                <path d="M 40 40 L 50 50 L 40 60" fill="none" stroke="#F97316" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                            </g>
                        </svg>
                    </div>
                    <div class="flex flex-col space-y-4">
                        <div id="card-ban-xia" data-herb-id="banha" class="herb-card p-4 rounded-lg shadow-sm">
                            <h3 class="text-xl font-bold text-emerald-800">반하: 용해제 (거담)</h3>
                            <p class="text-gray-600 mt-1">화학약품처럼 끈적한 담(痰)을 녹여 분해합니다.</p>
                        </div>
                        <div id="card-chen-pi" data-herb-id="jinpi" class="herb-card p-4 rounded-lg shadow-sm">
                            <h3 class="text-xl font-bold text-orange-800">진피: 압축기 (행기)</h3>
                            <p class="text-gray-600 mt-1">플런저(압축기)처럼 기(氣)를 움직여 녹은 담을 밀어냅니다.</p>
                        </div>
                        <div id="card-fu-ling" data-herb-id="bongnyeong" class="herb-card p-4 rounded-lg shadow-sm">
                            <h3 class="text-xl font-bold text-sky-800">복령: 세척제 (거습)</h3>
                            <p class="text-gray-600 mt-1">뜨거운 물로 하수구를 씻어내듯, 남은 찌꺼기를 소변으로 깨끗이 배출합니다.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Section 2: Formula Derivations -->
            <div>
                <header class="text-center mb-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 text-center mb-8">이진탕 기반 변방</h2>
                </header>
                <div class="p-4 rounded-2xl mb-8">
                    <div id="formula-list" class="flex flex-wrap justify-center gap-2"></div>
                </div>
                <div class="bg-white/50 p-6 rounded-2xl shadow-lg min-h-[500px] flex flex-col justify-between">
                    <div id="vis-container" class="relative w-full h-[400px] md:h-[450px]">
                        <div id="central-orb" class="central-orb absolute top-1/2 left-1/2 w-40 h-40 md:w-48 md:h-48 rounded-full flex flex-col items-center justify-center text-center -translate-x-1/2 -translate-y-1/2 transition-all duration-500">
                            <h2 id="info-title" class="text-2xl md:text-3xl font-bold text-white"></h2>
                        </div>
                    </div>
                    <div id="info-panel" class="text-center mt-4">
                        <p id="info-derivation" class="text-lg text-amber-800 font-medium mb-2"></p>
                        <p id="info-treats" class="text-gray-600"></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Herb Info Modal -->
    <div id="herb-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
        <div id="modal-content" class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md transform transition-all duration-300 scale-95 opacity-0">
            <div class="flex justify-between items-start mb-4">
                <h3 id="modal-herb-name" class="text-2xl font-bold text-gray-800" style="font-family: 'Noto Serif KR', serif;"></h3>
                <button id="modal-close-btn" class="text-3xl font-light leading-none text-gray-500 hover:text-gray-800 transition-colors">&times;</button>
            </div>
            <div>
                <p id="modal-herb-effect" class="text-gray-700"></p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="text-center py-8 mt-12 text-sm text-gray-500">
        <p>&copy; 2024 Hyungsuk Choi. All Rights Reserved.</p>
    </footer>

    <script>
        // --- Herb Data and Effects ---
        const allHerbs = [
            { id: 'banha', name: '반하' }, { id: 'jinpi', name: '진피' }, { id: 'bongnyeong', name: '복령' },
            { id: 'gamcho', name: '감초' }, { id: 'namseong', name: '남성' }, { id: 'jisil', name: '지실' },
            { id: 'jukyeo', name: '죽여' }, { id: 'cheonma', name: '천마' }, { id: 'baekchul', name: '백출' },
            { id: 'sikcheyak', name: '식체약' }, { id: 'yeongyo', name: '연교' }, { id: 'sukjihwang', name: '숙지황' },
            { id: 'danggwi', name: '당귀' }, { id: 'gwaru', name: '과루' }, { id: 'hwanggeum', name: '황금' },
            { id: 'hwangnyeon', name: '황련' }, { id: 'haengin', name: '행인' }, { id: 'gilgyeong', name: '길경' },
            { id: 'soyeop', name: '소엽' }, { id: 'jeonho', name: '전호' }, { id: 'jigak', name: '지각' },
            { id: 'hyangbuja', name: '향부자' }, { id: 'changchul', name: '창출' }, { id: 'pyeongwisan', name: '평위산' },
            { id: 'gwakhyang', name: '곽향' }, { id: 'geoseupyak', name: '거습약' }
        ];

        const herbEffects = {
            'banha': '습을 말리고 담을 삭이며, 거역하는 기를 아래로 내립니다.',
            'jinpi': '기를 조절하고 중초를 조정하며, 습을 말리고 담을 삭입니다.',
            'bongnyeong': '소변을 잘 나오게 하고 습을 배출하며, 비장을 강화하고 중초를 조화롭게 합니다.',
            'gamcho': '비장의 기를 보하고 폐를 촉촉하게 하며, 다른 약의 성질을 완화하고 조화시킵니다.',
            'namseong': '습을 말리고 담을 삭이며, 경락의 풍담을 흩어지게 합니다.',
            'jisil': '기의 정체를 깨뜨리고 적체를 줄이며, 담을 삭입니다.',
            'jukyeo': '열을 내리고 담을 삭이며, 위를 편안하게 합니다.',
            'cheonma': '풍을 끄고 떨림을 멈추게 하며, 통증을 완화합니다.',
            'baekchul': '비장을 보하고 기를 더하며, 습을 말리고 수분 대사를 촉진합니다.',
            'sikcheyak': '음식 정체를 완화하는 약재의 한 종류입니다.',
            'yeongyo': '열을 내리고 독을 풀며, 농양을 줄입니다.',
            'sukjihwang': '혈을 영양하고 음을 풍부하게 합니다.',
            'danggwi': '혈을 보하고 혈액 순환을 활발하게 하며, 월경을 조절합니다.',
            'gwaru': '열을 내리고 담열을 삭이며, 가슴을 넓혀줍니다.',
            'hwanggeum': '열을 내리고 습을 말리며, 독성을 해소합니다.',
            'hwangnyeon': '열을 내리고 습을 말리며, 화독을 해소합니다.',
            'haengin': '기침을 멈추고 천식을 진정시킵니다.',
            'gilgyeong': '폐를 열어주고 담을 배출하며, 목을 이롭게 합니다.',
            'soyeop': '표를 풀고 한기를 흩어지게 하며, 기의 움직임을 촉진합니다.',
            'jeonho': '기를 아래로 내리고 풍열을 흩어지게 하며, 담을 삭입니다.',
            'jigak': '기의 움직임을 촉진하고 팽만감을 줄입니다.',
            'hyangbuja': '간기를 퍼뜨리고 조절합니다.',
            'changchul': '강력하게 습을 말리고 비장을 강화합니다.',
            'pyeongwisan': '습을 말리고 비장 기능을 개선하는 처방입니다. 단일 약재가 아닙니다.',
            'gwakhyang': '습을 삭이고 표를 풀며, 중초를 조화롭게 합니다.',
            'geoseupyak': '습을 배출하는 약재의 한 종류입니다.'
        };

        // --- Script for Section 1: Drain Analogy ---
        const vizContainer = document.getElementById('visualization-container');
        const cards = {
            banXia: document.getElementById('card-ban-xia'),
            chenPi: document.getElementById('card-chen-pi'),
            fuLing: document.getElementById('card-fu-ling'),
        };
        let activeHerb = null;

        function setActiveHerb(herbName) {
            if (activeHerb === herbName) {
                resetState();
                return;
            }
            activeHerb = herbName;
            vizContainer.className = 'visualization-area w-full h-80 rounded-2xl shadow-inner p-4 flex items-center justify-center';
            Object.values(cards).forEach(card => card.classList.remove('active'));
            vizContainer.classList.add(`${herbName}-active`);
            document.getElementById(`card-${herbName}`).classList.add('active');
        }

        function resetState() {
            activeHerb = null;
            vizContainer.className = 'visualization-area w-full h-80 rounded-2xl shadow-inner p-4 flex items-center justify-center';
            Object.values(cards).forEach(card => card.classList.remove('active'));
        }

        cards.banXia.addEventListener('click', (e) => { e.stopPropagation(); setActiveHerb('ban-xia'); });
        cards.chenPi.addEventListener('click', (e) => { e.stopPropagation(); setActiveHerb('chen-pi'); });
        cards.fuLing.addEventListener('click', (e) => { e.stopPropagation(); setActiveHerb('fu-ling'); });
        
        document.body.addEventListener('click', (e) => {
            if (!e.target.closest('.herb-card') && !e.target.closest('.formula-item') && !e.target.closest('.herb-orb') && !e.target.closest('#modal-content')) {
                resetState();
            }
        }, true);

        // --- Script for Section 2: Formula Derivations ---
        const formulas = {
            'ijin-tang': { name: '이진탕', treats: '습담(濕痰)을 치료하는 기본 처방입니다.', derivation_text: "기본 처방", composition: { base: ['banha', 'jinpi', 'bongnyeong', 'gamcho'], added: [] } },
            'dodam-tang': { name: '도담탕', treats: '풍담(風痰)으로 인한 증상을 치료합니다.', derivation_text: "이진탕에 '남성', '지실'을 추가합니다.", composition: { base: ['banha', 'jinpi', 'bongnyeong', 'gamcho'], added: ['namseong', 'jisil'] } },
            'ondam-tang': { name: '온담탕', treats: '열담(熱痰)으로 인한 가슴 답답함과 불면을 치료합니다.', derivation_text: "이진탕에 '죽여', '지실'을 추가합니다.", composition: { base: ['banha', 'jinpi', 'bongnyeong', 'gamcho'], added: ['jukyeo', 'jisil'] } },
            'banha-baekchul-cheonma-tang': { name: '반하백출천마탕', treats: '담음(痰飲)으로 인한 현훈, 두통을 치료합니다.', derivation_text: "이진탕에 '천마', '백출'을 추가합니다.", composition: { base: ['banha', 'jinpi', 'bongnyeong', 'gamcho'], added: ['cheonma', 'baekchul'] } },
            'bohwa-hwan': { name: '보화환', treats: '식체(食滯)로 소화되지 않는 증상을 치료합니다.', derivation_text: "이진탕에 '식체약', '연교'를 추가합니다.", composition: { base: ['banha', 'jinpi', 'bongnyeong', 'gamcho'], added: ['sikcheyak', 'yeongyo'] } },
            'geumsu-yukgun-jeon': { name: '금수육군전', treats: '오래된 담증으로 인한 기침을 치료합니다.', derivation_text: "이진탕에 '숙지황', '당귀'를 추가합니다.", composition: { base: ['banha', 'jinpi', 'bongnyeong', 'gamcho'], added: ['sukjihwang', 'danggwi'] } },
            'cheonggi-hwadam-hwan': { name: '청기화담환', treats: '열담(熱痰)으로 인한 기침을 치료합니다.', derivation_text: "이진탕에 '과루', '남성', '황금', '지실', '황련'을 추가합니다.", composition: { base: ['banha', 'jinpi', 'bongnyeong', 'gamcho'], added: ['gwaru', 'namseong', 'hwanggeum', 'jisil', 'hwangnyeon'] } },
            'haengso-san': { name: '행소산', treats: '양조(凉燥)증으로 인한 기침을 치료합니다.', derivation_text: "이진탕에 '행인', '길경', '소엽', '전호', '지각'을 추가합니다.", composition: { base: ['banha', 'jinpi', 'bongnyeong', 'gamcho'], added: ['haengin', 'gilgyeong', 'soyeop', 'jeonho', 'jigak'] } },
            'changbu-dodam-tang': { name: '창부도담탕', treats: '비만한 사람의 불임증을 치료합니다.', derivation_text: "이진탕에 '남성', '지실', '향부자', '창출'을 추가합니다.", composition: { base: ['banha', 'jinpi', 'bongnyeong', 'gamcho'], added: ['namseong', 'jisil', 'hyangbuja', 'changchul'] } },
            'gwakhyang-jeonggi-san': { name: '곽향정기산', treats: '표리(表裏)를 겸한 이질, 곽란을 치료합니다.', derivation_text: "이진탕에 '평위산', '곽향', '소엽', '거습약'을 추가합니다.", composition: { base: ['banha', 'jinpi', 'bongnyeong', 'gamcho'], added: ['pyeongwisan', 'gwakhyang', 'soyeop', 'geoseupyak'] } }
        };
        
        const visContainer2 = document.getElementById('vis-container');
        const formulaListEl = document.getElementById('formula-list');
        const infoTitle = document.getElementById('info-title');
        const infoDerivation = document.getElementById('info-derivation');
        const infoTreats = document.getElementById('info-treats');

        function initializeFormulas() {
            allHerbs.forEach(herb => {
                const orb = document.createElement('div');
                orb.id = `herb-${herb.id}`;
                orb.className = 'herb-orb';
                orb.textContent = herb.name;
                orb.addEventListener('click', () => showHerbInfo(herb.id));
                visContainer2.appendChild(orb);
            });

            Object.keys(formulas).forEach(key => {
                const formula = formulas[key];
                const item = document.createElement('button');
                item.dataset.id = key;
                item.textContent = formula.name;
                item.className = 'formula-item font-medium py-2 px-4 rounded-full cursor-pointer transition-all duration-300 shadow-sm hover:shadow-md';
                item.addEventListener('click', () => updateDisplay(key));
                formulaListEl.appendChild(item);
            });
            updateDisplay('ijin-tang');
        }

        function updateDisplay(formulaId) {
            const formula = formulas[formulaId];
            if (!formula) return;

            infoTitle.textContent = formula.name;
            infoDerivation.textContent = formula.derivation_text;
            infoTreats.textContent = formula.treats;

            document.querySelectorAll('.formula-item').forEach(item => {
                item.classList.toggle('active', item.dataset.id === formulaId);
            });

            const currentHerbs = [...new Set([...formula.composition.base, ...formula.composition.added])];
            const radius = Math.min(visContainer2.clientWidth, visContainer2.clientHeight) / 2 * 0.7;
            const angleStep = currentHerbs.length > 0 ? (2 * Math.PI) / currentHerbs.length : 0;

            const groupHerbIds = ['sikcheyak', 'pyeongwisan', 'geoseupyak'];

            let visibleHerbCount = 0;
            allHerbs.forEach(herb => {
                const orb = document.getElementById(`herb-${herb.id}`);
                if (currentHerbs.includes(herb.id)) {
                    orb.classList.add('visible');
                    
                    const isGroup = groupHerbIds.includes(herb.id);
                    const isBase = formula.composition.base.includes(herb.id);

                    orb.classList.remove('base', 'added', 'group');

                    if (isGroup) {
                        orb.classList.add('group');
                    } else if (isBase) {
                        orb.classList.add('base');
                    } else {
                        orb.classList.add('added');
                    }

                    const angle = angleStep * visibleHerbCount - (Math.PI / 2);
                    const x = (visContainer2.clientWidth / 2) + radius * Math.cos(angle) - 40;
                    const y = (visContainer2.clientHeight / 2) + radius * Math.sin(angle) - 40;
                    orb.style.left = `${x}px`;
                    orb.style.top = `${y}px`;
                    visibleHerbCount++;
                } else {
                    orb.classList.remove('visible', 'base', 'added', 'group');
                }
            });
        }

        initializeFormulas();
        window.addEventListener('resize', () => {
            const activeFormula = document.querySelector('.formula-item.active')?.dataset.id || 'ijin-tang';
            updateDisplay(activeFormula);
        });

        // --- Modal Logic ---
        const herbModal = document.getElementById('herb-modal');
        const modalContent = document.getElementById('modal-content');
        const modalHerbName = document.getElementById('modal-herb-name');
        const modalHerbEffect = document.getElementById('modal-herb-effect');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        function showHerbInfo(herbId) {
            const herb = allHerbs.find(h => h.id === herbId);
            const effect = herbEffects[herbId];
            if (herb && effect) {
                modalHerbName.textContent = herb.name;
                modalHerbEffect.textContent = effect;
                herbModal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10);
            }
        }

        function closeHerbInfo() {
            modalContent.classList.add('scale-95', 'opacity-0');
            modalContent.classList.remove('scale-100', 'opacity-100');
            setTimeout(() => {
                herbModal.classList.add('hidden');
            }, 300);
        }

        modalCloseBtn.addEventListener('click', closeHerbInfo);
        herbModal.addEventListener('click', (event) => {
            if (event.target === herbModal) {
                closeHerbInfo();
            }
        });
    </script>
</body>
</html>
