<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QC84KCE6C1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QC84KCE6C1');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hacking Formula Names</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Noto+Serif+KR:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #F7F3EF;
            font-family: 'Inter', sans-serif;
        }
        .noto-serif {
            font-family: 'Noto Serif KR', serif;
        }
        .btn {
            transition: all 0.2s ease-in-out;
            transform: scale(1);
        }
        .btn.active-action, .btn.active-target {
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 14px 0 rgb(0 0 0 / 10%);
        }
        /* Action color is brown */
        .btn.active-action {
            background-color: #A16207; /* amber-700 */
            border-color: #A16207;
        }
        .btn.active-target {
            background-color: #14B8A6; /* teal-500 */
            border-color: #14B8A6;
        }
        .result-card {
            transition: all 0.3s ease-out;
            min-height: 160px;
        }
    </style>
</head>
<body class="text-gray-800">

    <!-- Header -->
    <header class="w-full max-w-4xl mx-auto my-4 px-4 flex justify-between items-center">
        <a href="index.html" 
           class="noto-serif text-lg font-semibold text-gray-700 no-underline">
            &larr; Interactive TCM
        </a>
        <!-- Language Toggle Button -->
        <button id="lang-toggle" class="bg-gray-200 text-gray-700 px-3 py-1.5 text-sm rounded-lg font-medium hover:bg-gray-300 transition-colors">
            Kor / Eng
        </button>
    </header>


    <main class="w-full max-w-5xl mx-auto px-4 pb-16">
        <div class="text-center mb-10">
            <!-- Title font is sans-serif (Inter) -->
            <h1 id="main-title" class="text-3xl md:text-4xl font-bold text-gray-900 mb-2">Hacking Formula Names</h1>
            <p id="subtitle" class="text-base md:text-lg text-gray-600 max-w-3xl mx-auto">The most common naming convention combines an <span class="font-semibold text-amber-700">action</span> with its <span class="font-semibold text-teal-600">target</span>. Click a button from each category to see how they combine.</p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12">
            <!-- Actions Section -->
            <div>
                <h2 id="actions-title" class="text-2xl font-bold mb-4 noto-serif text-amber-700 text-center">Actions</h2>
                <!-- Centered the container -->
                <div id="actions-container" class="flex flex-wrap justify-center gap-3">
                    <!-- Action buttons will be injected here -->
                </div>
            </div>

            <!-- Targets Section -->
            <div>
                <h2 id="targets-title" class="text-2xl font-bold mb-4 noto-serif text-teal-500 text-center">Targets</h2>
                <!-- Centered the container -->
                <div id="targets-container" class="flex flex-wrap justify-center gap-3">
                    <!-- Target buttons will be injected here -->
                </div>
            </div>
        </div>

        <!-- Combination Result Section -->
        <div class="mt-12">
            <div id="result-card" class="result-card bg-white rounded-xl shadow-lg p-6 md:p-8 border border-gray-200 flex flex-col justify-center items-center text-center">
                <p id="result-placeholder" class="text-gray-500">Select an action and a target to see the result.</p>
                <div id="result-content" class="hidden">
                    <h3 id="combined-term" class="text-3xl md:text-4xl font-bold text-gray-800"></h3>
                    <p id="combined-meaning" class="text-lg md:text-xl text-gray-600 mt-2"></p>
                    <div id="example-container" class="mt-4 pt-4 border-t border-gray-200 w-full hidden">
                         <p id="example-label" class="text-sm text-gray-500 mb-1">Example Formula:</p>
                         <p id="example-formula" class="text-xl font-semibold text-gray-700 leading-relaxed"></p>
                    </div>
                </div>
            </div>
            <div class="text-center mt-4">
                <button id="clear-button" class="bg-gray-200 text-gray-700 px-6 py-2 rounded-lg font-medium hover:bg-gray-300 transition-colors">Clear Selection</button>
            </div>
        </div>

        <!-- Answer Key Section -->
        <div class="mt-16 text-center border-t pt-8">
            <button id="toggle-answers-btn" class="bg-gray-600 text-white px-6 py-2 rounded-lg font-medium hover:bg-gray-700 transition-colors">
                Click to see all hidden formulas
            </button>
            <div id="answer-key-list" class="hidden mt-6 bg-white p-6 rounded-xl shadow-lg text-left max-w-2xl mx-auto">
                <!-- The list of formulas will be generated here by JS -->
            </div>
        </div>

    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- Language Data ---
            const langData = {
                en: {
                    mainTitle: 'Hacking Formula Names',
                    subtitle: 'The most common naming convention combines an <span class="font-semibold text-amber-700">action</span> with its <span class="font-semibold text-teal-600">target</span>. Click a button from each category to see how they combine.',
                    actionsTitle: 'Actions',
                    targetsTitle: 'Targets',
                    resultPlaceholder: 'Select an action and a target to see the result.',
                    exampleLabel: 'Example Formula:',
                    clearButton: 'Clear Selection',
                    toggleButtonShow: 'Click to see all hidden formulas',
                    toggleButtonHide: 'Hide formula list',
                    actions: {
                        'Xie': 'Drain excess', 'Qing': 'Clear heat', 'Xiao': 'Eliminate', 'Bu': 'Tonify', 'Jian': 'Tonify',
                        'Yi': 'Tonify', 'Ping': 'Pacify', 'Wen': 'Warm, tonify', 'li': 'Regulate'
                    },
                    targets: {
                        'Xin': 'Heart', 'Dan': 'Gallbladder', 'Gan': 'Liver', 'Pi': 'Spleen', 'Wei': 'Stomach', 'Fei': 'Lung',
                        'Zhong': 'Middle Jiao', 'Huang': 'Yellow, imply Earth, Spleen', 'Bai': 'White, imply Metal, Lung',
                        'Feng': 'Wind', 'Xue': 'Blood', 'Qi': 'Qi, energy', 'Du': 'Toxin', 'Jing': 'Meridian, Menstruation'
                    }
                },
                ko: {
                    mainTitle: '처방 이름 해부하기',
                    subtitle: '가장 일반적인 처방 명명법은 <span class="font-semibold text-amber-700">작용</span>과 <span class="font-semibold text-teal-600">표적</span>을 결합하는 것입니다. 각 카테고리에서 버튼을 클릭하여 어떻게 결합되는지 확인해 보세요.',
                    actionsTitle: '작용 (Actions)',
                    targetsTitle: '표적 (Targets)',
                    resultPlaceholder: '작용과 표적을 선택하여 결과를 확인하세요.',
                    exampleLabel: '예시 처방:',
                    clearButton: '선택 해제',
                    toggleButtonShow: '숨어있는 처방들을 보려면 클릭',
                    toggleButtonHide: '처방 목록 숨기기',
                    actions: {
                        'Xie': '사하다', 'Qing': '열을 내리다', 'Xiao': '없애다', 'Bu': '보충하다', 'Jian': '튼튼하게 하다',
                        'Yi': '더하다', 'Ping': '평온하게 하다', 'Wen': '따뜻하게 하다', 'li': '조절하다'
                    },
                    targets: {
                        'Xin': '심장', 'Dan': '담', 'Gan': '간', 'Pi': '비장', 'Wei': '위', 'Fei': '폐',
                        'Zhong': '중초', 'Huang': '황(비장)', 'Bai': '백(폐)',
                        'Feng': '풍', 'Xue': '혈', 'Qi': '기', 'Du': '독', 'Jing': '경락/월경'
                    }
                }
            };

            // --- Formula Data (Language Independent) ---
            const examples = {
                'XieGan': 'Long Dan Xie Gan Tang', 'XieXin': 'Ban Xia Xie Xin Tang', 'XieHuang': 'Xie Huang San', 'XieBai': 'Xie Bai San',
                'QingWei': 'Qing Wei San', 'QingGan': 'Qing Gan Ming Mu Tang', 'QingXin': 'Niu Huang Qing Xin Wan', 'QingFei': 'Qing Qi Hua Tan Wan',
                'QingXue': 'Qing Xue Si Wu Tang', 'QingJin': 'Qing Qi Hua Tan Wan', 'QingQi': 'Qing Qi Hua Tan Wan',
                'BuXue': 'Dang Gui Bu Xue Tang', 'BuXin': 'Tian Wang Bu Xin Dan', 'BuFei': 'Bu Fei Yuan Tang', 'BuZhong': 'Bu Zhong Yi Qi Tang',
                'JianZhong': 'Xiao Jian Zhong Tang', 'JianPi': 'Jian Pi Wan', 'XiaoFeng': 'Xiao Feng San', 'XiaoDu': 'Pu Ji Xiao Du Yin, Wu Wei Xiao Du Yin',
                'PingWei': 'Ping Wei San', 'WenJing': 'Wen Jing Tang', 'WenDan': 'Wen Dan Tang', 'LiZhong': 'Li Zhong Wan', 'LiQi': 'Li Qi Qu Feng San', 'YiQi': 'Bu Zhong Yi Qi Tang'
            };

            // --- App State ---
            let selectedAction = null;
            let selectedTarget = null;
            let currentLang = 'en';

            // --- DOM Elements ---
            const actionsContainer = document.getElementById('actions-container');
            const targetsContainer = document.getElementById('targets-container');
            const resultPlaceholder = document.getElementById('result-placeholder');
            const resultContent = document.getElementById('result-content');
            const combinedTermEl = document.getElementById('combined-term');
            const combinedMeaningEl = document.getElementById('combined-meaning');
            const exampleContainer = document.getElementById('example-container');
            const exampleFormulaEl = document.getElementById('example-formula');
            const clearButton = document.getElementById('clear-button');
            const toggleBtn = document.getElementById('toggle-answers-btn');
            const answerListDiv = document.getElementById('answer-key-list');
            const langToggleBtn = document.getElementById('lang-toggle');

            // --- Functions ---

            const getLangFromURL = () => {
                const params = new URLSearchParams(window.location.search);
                const lang = params.get('lang');
                return (lang === 'ko') ? 'ko' : 'en';
            };

            const updateLanguage = (lang) => {
                currentLang = lang;
                const data = langData[lang];
                document.documentElement.lang = lang;

                document.getElementById('main-title').textContent = data.mainTitle;
                document.getElementById('subtitle').innerHTML = data.subtitle;
                document.getElementById('actions-title').textContent = data.actionsTitle;
                document.getElementById('targets-title').textContent = data.targetsTitle;
                resultPlaceholder.textContent = data.resultPlaceholder;
                document.getElementById('example-label').textContent = data.exampleLabel;
                clearButton.textContent = data.clearButton;
                toggleBtn.textContent = answerListDiv.classList.contains('hidden') ? data.toggleButtonShow : data.toggleButtonHide;

                populateButtons();
                updateResult();
            };
            
            const createButton = (term, meaning, type) => {
                const button = document.createElement('button');
                button.className = `btn bg-white border border-gray-300 rounded-lg px-4 py-2 text-left shadow-sm hover:border-gray-400 hover:bg-gray-50`;
                button.innerHTML = `<span class="font-bold text-lg">${term}</span><br><span class="text-sm text-gray-600">${meaning}</span>`;
                button.dataset.term = term;
                button.dataset.type = type;
                return button;
            };
            
            const populateButtons = () => {
                actionsContainer.innerHTML = '';
                targetsContainer.innerHTML = '';

                const currentActions = langData[currentLang].actions;
                for (const term in currentActions) {
                    const btn = createButton(term, currentActions[term], 'action');
                    actionsContainer.appendChild(btn);
                }

                const currentTargets = langData[currentLang].targets;
                for (const term in currentTargets) {
                    const btn = createButton(term, currentTargets[term], 'target');
                    targetsContainer.appendChild(btn);
                }
                
                addButtonListeners();
                
                // Re-apply active classes after repopulating
                if (selectedAction) {
                    const activeBtn = actionsContainer.querySelector(`[data-term="${selectedAction.term}"]`);
                    if (activeBtn) activeBtn.classList.add('active-action');
                }
                if (selectedTarget) {
                    const activeBtn = targetsContainer.querySelector(`[data-term="${selectedTarget.term}"]`);
                    if (activeBtn) activeBtn.classList.add('active-target');
                }
            };

            const addButtonListeners = () => {
                document.querySelectorAll('.btn').forEach(button => {
                    button.addEventListener('click', () => {
                        const { term, type } = button.dataset;

                        if (type === 'action') {
                            document.querySelectorAll('.btn[data-type="action"]').forEach(b => b.classList.remove('active-action'));
                            button.classList.add('active-action');
                            selectedAction = { term };
                        } else if (type === 'target') {
                            document.querySelectorAll('.btn[data-type="target"]').forEach(b => b.classList.remove('active-target'));
                            button.classList.add('active-target');
                            selectedTarget = { term };
                        }
                        updateResult();
                    });
                });
            };

            const updateResult = () => {
                if (selectedAction && selectedTarget) {
                    const actionTerm = selectedAction.term;
                    const targetTerm = selectedTarget.term;
                    
                    const actionKey = actionTerm.charAt(0).toUpperCase() + actionTerm.slice(1);
                    const targetKey = targetTerm.charAt(0).toUpperCase() + targetTerm.slice(1);
                    const exampleKey = `${actionKey}${targetKey}`;
                    
                    resultPlaceholder.classList.add('hidden');
                    resultContent.classList.remove('hidden');
                    
                    combinedTermEl.textContent = `${actionTerm} ${targetTerm}`;
                    combinedMeaningEl.textContent = `${langData[currentLang].actions[actionTerm]} ${langData[currentLang].targets[targetTerm]}`;

                    if (examples[exampleKey]) {
                        const formulaText = examples[exampleKey].replace(/, /g, '<br>');
                        exampleFormulaEl.innerHTML = formulaText;
                        exampleContainer.classList.remove('hidden');
                    } else {
                        exampleContainer.classList.add('hidden');
                    }
                }
            };
            
            const clearSelection = () => {
                selectedAction = null;
                selectedTarget = null;
                document.querySelectorAll('.btn').forEach(b => {
                    b.classList.remove('active-action');
                    b.classList.remove('active-target');
                });
                
                resultPlaceholder.classList.remove('hidden');
                resultContent.classList.add('hidden');
                exampleContainer.classList.add('hidden');
            };

            // --- Initialization ---
            currentLang = getLangFromURL();
            updateLanguage(currentLang);

            clearButton.addEventListener('click', clearSelection);
            
            langToggleBtn.addEventListener('click', () => {
                const newLang = currentLang === 'en' ? 'ko' : 'en';
                // Manually trigger the language update without reloading
                updateLanguage(newLang);
            });

            // --- Answer Key Logic ---
            const allFormulas = [...new Set(Object.values(examples).flatMap(f => f.split(', ')))].sort();
            const ul = document.createElement('ul');
            ul.className = 'list-disc list-inside grid grid-cols-1 sm:grid-cols-2 gap-x-8 gap-y-2';
            allFormulas.forEach(formula => {
                const li = document.createElement('li');
                li.textContent = formula;
                ul.appendChild(li);
            });
            answerListDiv.appendChild(ul);

            toggleBtn.addEventListener('click', () => {
                const isHidden = answerListDiv.classList.contains('hidden');
                if (isHidden) {
                    answerListDiv.classList.remove('hidden');
                    toggleBtn.textContent = langData[currentLang].toggleButtonHide;
                } else {
                    answerListDiv.classList.add('hidden');
                    toggleBtn.textContent = langData[currentLang].toggleButtonShow;
                }
            });
        });
    </script>
</body>
</html>
