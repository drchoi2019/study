<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QC84KCE6C1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QC84KCE6C1');
</script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>계지탕의 변방들</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F7F3EF;
            color: #4a4a4a;
            overflow-x: hidden;
        }
        .formula-item {
            background-color: #e9e2d9;
            color: #5a5a5a;
        }
        .formula-item.active {
            background-color: #A67B5B;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .central-orb {
            background: radial-gradient(circle, #A67B5B 0%, #6F5B3E 70%);
            box-shadow: 0 0 20px #C89F76, 0 0 40px #C89F76, inset 0 0 15px #e6c5a8;
        }
        .herb-orb {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            padding: 2px;
            transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            opacity: 0;
            transform: scale(0);
            cursor: pointer; /* 클릭 가능한 약재에 커서 포인터 추가 */
        }
        .herb-orb:hover {
            transform: scale(1.1) !important; /* 마우스 오버 효과 추가 */
        }
        .herb-orb.visible {
            opacity: 1;
            transform: scale(1);
        }
        .herb-orb.base {
            background: radial-gradient(circle, #D4A373, #A17C4F);
            box-shadow: 0 0 10px #D4A373, inset 0 0 5px #f3d8b7;
            color: white;
        }
        .herb-orb.added {
            background: radial-gradient(circle, #81A89D, #52796F);
            box-shadow: 0 0 10px #81A89D, inset 0 0 5px #bde0d9;
            color: white;
        }
        /* Modal styles */
        .modal {
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

<header style="width: 100%; max-width: 48rem; margin: 1rem auto; padding: 0 1rem; display: flex; justify-content: space-between; align-items: center;">
    <a href="index.html" style="font-family: serif; font-size: 1.125rem; font-weight: 600; color: rgb(55, 65, 81); text-decoration: none;">
        &larr; Interactive TCM
    </a>
</header>

    <main class="flex-grow">
        <div class="max-w-4xl mx-auto px-4">
            <header class="text-center mb-8">
                <br>
                <h1 class="text-3xl md:text-4xl font-bold text-gray-800" style="font-family: 'Playfair Display', serif;">계지탕 변방 처방구성</h1>
                <p class="mt-2 text-gray-600">처방을 선택하여 구성을 보고, 약재를 클릭하여 효능을 확인하세요.</p>
            </header>

            <!-- Formula List -->
            <div class="p-4 rounded-2xl mb-8">
                <div id="formula-list" class="flex flex-wrap justify-center gap-2">
                    <!-- Formula list will be populated by JS -->
                </div>
            </div>

            <!-- Visualization Area -->
            <div class="bg-white/50 p-6 rounded-2xl shadow-lg min-h-[500px] flex flex-col justify-between">
                <div id="vis-container" class="relative w-full h-[400px] md:h-[450px]">
                    <div id="central-orb" class="central-orb absolute top-1/2 left-1/2 w-40 h-40 md:w-48 md:h-48 rounded-full flex flex-col items-center justify-center text-center -translate-x-1/2 -translate-y-1/2 transition-all duration-500">
                        <h2 id="info-title" class="text-2xl md:text-3xl font-bold text-white p-2"></h2>
                    </div>
                    <!-- Herb orbs will be populated here -->
                </div>
                <div id="info-panel" class="text-center mt-4">
                    <p id="info-derivation" class="text-lg text-amber-800 font-medium mb-2"></p>
                    <p id="info-treats" class="text-gray-600"></p>
                </div>
            </div>
        </div>
    </main>

    <!-- Herb Info Modal -->
    <div id="herb-modal" class="modal fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50">
        <div id="modal-content" class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-md transform transition-all duration-300 scale-95 opacity-0">
            <div class="flex justify-between items-start mb-4">
                <h3 id="modal-herb-name" class="text-2xl font-bold text-gray-800" style="font-family: 'Playfair Display', serif;"></h3>
                <button id="modal-close-btn" class="text-3xl font-light leading-none text-gray-500 hover:text-gray-800 transition-colors">&times;</button>
            </div>
            <div>
                <p id="modal-herb-effect" class="text-gray-700"></p>
            </div>
        </div>
    </div>

    <!-- Footer for Individual Pages -->
    <footer class="text-center py-8 mt-12 text-sm text-gray-500">
        <p>&copy; 2024 Hyungsuk Choi. All Rights Reserved.</p>
    </footer>

    <script>
        // 모든 약재 데이터
        const allHerbs = [
            { id: 'gyeji', name: '계지' }, { id: 'jakyak', name: '작약' }, { id: 'saenggang', name: '생강' },
            { id: 'daejo', name: '대조' }, { id: 'gamcho', name: '감초' }, { id: 'mahwang', name: '마황' },
            { id: 'galgeun', name: '갈근' }, { id: 'idang', name: '이당' }, { id: 'dangwi', name: '당귀' },
            { id: 'moktong', name: '목통' }, { id: 'sesin', name: '세신' }, { id: 'samultang', name: '사물탕' },
            { id: 'hwanggi', name: '황기' }, { id: 'baekhasuo', name: '백하수오' }
        ];

        // 'herb_db.txt' 데이터를 시뮬레이션하는 객체
        const herbEffects = {
            'gyeji': '온경통맥하고 해기하며 양기를 돕습니다.',
            'jakyak': '양혈하고 월경을 조절하며 간양을 평안하게 하고 통증을 완화합니다.',
            'saenggang': '중초를 따뜻하게 하고 구토를 멈추게 하며 담을 삭이고 해표합니다.',
            'daejo': '기를 보하고 혈을 영양하며 다른 약의 성질을 조화시킵니다.',
            'gamcho': '비기를 보하고 폐를 윤택하게 하며 열을 내리고 독을 풀며 다른 약을 조화시킵니다.',
            'mahwang': '땀을 내어 해표하고 폐기를 선발하며 천식을 평안하게 합니다.',
            'galgeun': '해표하고 열을 내리며 진액을 생성하고 양기를 들어 올립니다.',
            'idang': '중초를 보하고 통증을 완화하며 폐를 윤택하게 합니다.',
            'dangwi': '혈을 보하고 혈액순환을 활발하게 하며 월경을 조절하고 통증을 완화합니다.',
            'moktong': '이뇨를 촉진하고 열을 내리며 경락을 통하게 합니다.',
            'sesin': '한사를 흩어지게 하고 통증을 완화하며 폐를 따뜻하게 하고 담을 삭입니다.',
            'samultang': '혈을 보하고 활혈하는 기본 처방입니다. 단일 약재가 아닙니다.',
            'hwanggi': '기와 혈을 보하고 양기를 들어 올리며 표를 견고하게 합니다.',
            'baekhasuo': '혈과 음을 영양하고 정을 굳건히 합니다.'
        };

        // 각 처방 데이터
        const formulas = {
            'gyeji-tang': {
                name: '계지탕',
                treats: '상한중풍증을 치료합니다.',
                derivation_text: "기본 처방",
                composition: { base: ['gyeji', 'jakyak', 'saenggang', 'daejo', 'gamcho'], added: [] }
            },
            'gyeji-ga-gye-tang': {
                name: '계지가계탕',
                treats: '양허증으로 인한 상충감, 두통을 치료합니다.',
                derivation_text: "계지탕에서 '계지'를 두 배로 증량합니다.",
                composition: { base: ['gyeji', 'jakyak', 'saenggang', 'daejo', 'gamcho'], added: [] }
            },
            'gyeji-ga-jakyak-tang': {
                name: '계지가작약탕',
                treats: '성인의 복통을 치료합니다.',
                derivation_text: "계지탕에서 '작약'을 두 배로 증량합니다.",
                composition: { base: ['gyeji', 'jakyak', 'saenggang', 'daejo', 'gamcho'], added: [] }
            },
            'so-geonjung-tang': {
                name: '소건중탕',
                treats: '허약한 소아의 복통, 피로를 치료합니다.',
                derivation_text: "계지가작약탕에 '이당(엿)'을 추가합니다.",
                composition: { base: ['gyeji', 'jakyak', 'saenggang', 'daejo', 'gamcho'], added: ['idang'] }
            },
            'galgeun-tang': {
                name: '갈근탕',
                treats: '풍한 감모와 뒷목, 어깨의 뻣뻣함을 치료합니다.',
                derivation_text: "계지탕에 '마황', '갈근'을 추가합니다.",
                composition: { base: ['gyeji', 'jakyak', 'saenggang', 'daejo', 'gamcho'], added: ['mahwang', 'galgeun'] }
            },
            'danggwi-sayeok-tang': {
                name: '당귀사역탕',
                treats: '양허, 혈허, 기체로 인한 수족냉증을 치료합니다.',
                derivation_text: "계지탕에 '당귀', '목통', '세신'을 추가합니다.",
                composition: { base: ['gyeji', 'jakyak', 'saenggang', 'daejo', 'gamcho'], added: ['dangwi', 'moktong', 'sesin'] }
            },
            'ssanghwa-tang': {
                name: '쌍화탕',
                treats: '과로 후 기혈이 모두 허해졌을 때 오는 감모증을 치료합니다.',
                derivation_text: "계지탕에 '사물탕'과 '황기'를 추가합니다.",
                composition: { base: ['gyeji', 'jakyak', 'saenggang', 'daejo', 'gamcho'], added: ['samultang', 'hwanggi'] }
            },
            'hwanggi-gyeji-tang': {
                name: '황기계지탕',
                treats: '소음인의 망양증을 치료합니다.',
                derivation_text: "계지탕에 '황기', '백하수오', '당귀'를 추가합니다.",
                composition: { base: ['gyeji', 'jakyak', 'saenggang', 'daejo', 'gamcho'], added: ['hwanggi', 'baekhasuo', 'dangwi'] }
            }
        };
        
        // DOM 요소 참조
        const visContainer = document.getElementById('vis-container');
        const formulaListEl = document.getElementById('formula-list');
        const infoTitle = document.getElementById('info-title');
        const infoDerivation = document.getElementById('info-derivation');
        const infoTreats = document.getElementById('info-treats');
        
        // 모달 DOM 요소 참조
        const herbModal = document.getElementById('herb-modal');
        const modalContent = document.getElementById('modal-content');
        const modalHerbName = document.getElementById('modal-herb-name');
        const modalHerbEffect = document.getElementById('modal-herb-effect');
        const modalCloseBtn = document.getElementById('modal-close-btn');

        // 애플리케이션 초기화
        function initialize() {
            // 약재 오브 생성 및 시각화 컨테이너에 추가
            allHerbs.forEach(herb => {
                const orb = document.createElement('div');
                orb.id = `herb-${herb.id}`;
                orb.className = 'herb-orb';
                orb.textContent = herb.name;
                // 약재 정보 팝업을 표시하는 클릭 이벤트 추가
                orb.addEventListener('click', () => showHerbInfo(herb.id));
                visContainer.appendChild(orb);
            });

            // 처방 선택 버튼 생성
            Object.keys(formulas).forEach(key => {
                const formula = formulas[key];
                const item = document.createElement('button');
                item.dataset.id = key;
                item.textContent = formula.name;
                item.className = 'formula-item font-medium py-2 px-4 rounded-full cursor-pointer transition-all duration-300 shadow-sm hover:shadow-md';
                item.addEventListener('click', () => updateDisplay(key));
                formulaListEl.appendChild(item);
            });
            
            // 모달 닫기 이벤트 리스너 추가
            modalCloseBtn.addEventListener('click', closeHerbInfo);
            herbModal.addEventListener('click', (event) => {
                if (event.target === herbModal) {
                    closeHerbInfo();
                }
            });

            // 초기 화면을 기본 처방으로 설정
            updateDisplay('gyeji-tang');
        }

        // 새 처방 선택 시 화면 업데이트
        function updateDisplay(formulaId) {
            const formula = formulas[formulaId];
            if (!formula) return;

            // 정보 패널 텍스트 업데이트
            infoTitle.textContent = formula.name;
            infoDerivation.textContent = formula.derivation_text;
            infoTreats.textContent = formula.treats;

            // 활성 상태인 처방 버튼 업데이트
            document.querySelectorAll('.formula-item').forEach(item => {
                item.classList.toggle('active', item.dataset.id === formulaId);
            });

            const currentHerbs = [...new Set([...formula.composition.base, ...formula.composition.added])];
            const radius = Math.min(visContainer.clientWidth, visContainer.clientHeight) / 2 * 0.75;
            const angleStep = currentHerbs.length > 0 ? (2 * Math.PI) / currentHerbs.length : 0;

            let visibleHerbCount = 0;
            // 약재 오브 위치 및 스타일 지정
            allHerbs.forEach(herb => {
                const orb = document.getElementById(`herb-${herb.id}`);
                if (currentHerbs.includes(herb.id)) {
                    orb.classList.add('visible');
                    orb.classList.toggle('base', formula.composition.base.includes(herb.id));
                    orb.classList.toggle('added', formula.composition.added.includes(herb.id));
                    
                    const angle = angleStep * visibleHerbCount - (Math.PI / 2); // 위쪽에서 시작
                    const x = (visContainer.clientWidth / 2) + radius * Math.cos(angle) - 40; // 40은 오브 너비의 절반
                    const y = (visContainer.clientHeight / 2) + radius * Math.sin(angle) - 40; // 40은 오브 높이의 절반
                    orb.style.left = `${x}px`;
                    orb.style.top = `${y}px`;
                    visibleHerbCount++;
                } else {
                    orb.classList.remove('visible', 'base', 'added');
                }
            });
        }

        // 약재 정보 팝업 표시
        function showHerbInfo(herbId) {
            const herb = allHerbs.find(h => h.id === herbId);
            const effect = herbEffects[herbId];

            if (herb && effect) {
                modalHerbName.textContent = herb.name;
                modalHerbEffect.textContent = effect;
                herbModal.classList.remove('hidden');
                // 트랜지션 트리거
                setTimeout(() => {
                    modalContent.classList.remove('scale-95', 'opacity-0');
                    modalContent.classList.add('scale-100', 'opacity-100');
                }, 10); 
            }
        }

        // 약재 정보 팝업 닫기
        function closeHerbInfo() {
            modalContent.classList.add('scale-95', 'opacity-0');
            modalContent.classList.remove('scale-100', 'opacity-100');
            setTimeout(() => {
                herbModal.classList.add('hidden');
            }, 300); // 트랜지션 시간과 일치
        }

        // 초기 설정
        initialize();

        // 창 크기 조절 시 위치 재계산을 위한 이벤트 리스너 추가
        window.addEventListener('resize', () => {
            const activeFormula = document.querySelector('.formula-item.active')?.dataset.id || 'gyeji-tang';
            updateDisplay(activeFormula);
        });
    </script>
</body>
</html>
