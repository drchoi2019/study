<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>메모</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: white; /* 전체 배경을 흰색으로 */
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
            overflow-y: scroll; /* 스크롤바는 있으나, 내용이 넘칠 때만 보이도록 */
        }
        
        /* 스크롤바 숨김 (IE, Edge, Firefox, Chrome, Safari 호환) */
        body::-webkit-scrollbar {
            display: none; /* Chrome, Safari */
        }
        body {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }

        #editor-container {
            /* 최대 폭(800px) 및 중앙 정렬 마진 제거 -> 창 크기에 따라 100% 폭으로 가변 */
            width: 100%; 
            background-color: white;
        }
        
        #content {
            font-size: 1.28rem; /* 폰트 크기를 1.28rem으로 변경 */
            line-height: 1.6;
            caret-color: #333; /* 커서 색상 */
            color: #1f2937; /* text-gray-800에 해당하는 색상 */
            min-height: 100vh;
            padding-top: 2rem; /* 상단 여백 유지 */
            padding-bottom: 50vh; /* 하단 여백 유지 */
            padding-left: 1.5rem; /* 좌측 여백을 1.5rem으로 설정 */
            padding-right: 1.5rem; /* 우측 여백을 1.5rem으로 설정 */
        }

        #content:focus {
            outline: none;
        }

        #content b, #content strong { font-weight: 700; }
        #content u { text-decoration: underline; }

        #content img {
            max-width: 100%;
            height: auto;
            margin: 1rem 0;
            display: block;
        }
    </style>
</head>
<body class="p-0 m-0">

    <div id="editor-container">
        <div id="content" 
             contenteditable="true" 
             class="max-w-none" /* prose 클래스를 제거하고 최소 클래스만 유지 */
             data-placeholder="여기에 메모를 시작하세요..."
             role="textbox" 
             aria-multiline="true">
        </div>
    </div>

    <script>
        const content = document.getElementById('content');
        const STORAGE_KEY = 'memo_app_content'; // localStorage 키 정의
        // CSS에서 1.28rem으로 설정된 초기 폰트 크기를 가져옵니다.
        let currentFontSizePx = parseFloat(getComputedStyle(content).fontSize); 

        // 1. 저장된 내용을 불러오는 함수
        function loadContent() {
            const savedContent = localStorage.getItem(STORAGE_KEY);
            if (savedContent) {
                content.innerHTML = savedContent;
            }
        }

        // 2. 내용을 저장하는 함수
        function saveContent() {
            localStorage.setItem(STORAGE_KEY, content.innerHTML);
        }

        function adjustFontSize(delta) {
            currentFontSizePx = Math.max(12, Math.min(32, currentFontSizePx + delta));
            content.style.fontSize = `${currentFontSizePx}px`;
            // 폰트 크기 변경 시에도 저장 (다음에 로드할 때 적용되도록)
            localStorage.setItem('memo_app_font_size', currentFontSizePx); 
        }

        // 3. 초기 로드 시 저장된 폰트 크기 적용
        function loadFontSize() {
             const savedSize = localStorage.getItem('memo_app_font_size');
             if (savedSize) {
                 currentFontSizePx = parseFloat(savedSize);
                 content.style.fontSize = `${currentFontSizePx}px`;
             }
        }


        document.addEventListener('keydown', (e) => {
            const isModifier = e.metaKey || e.ctrlKey;

            if (isModifier) {
                if (e.key === 'b') {
                    e.preventDefault();
                    document.execCommand('bold', false, null);
                } else if (e.key === 'u') {
                    e.preventDefault();
                    document.execCommand('underline', false, null);
                } else if (e.key === '=') {
                    e.preventDefault();
                    adjustFontSize(2);
                } else if (e.key === '-') {
                    e.preventDefault();
                    adjustFontSize(-2);
                }
            } else if (e.key === 'Tab') { // Tab 키 기능 추가
                e.preventDefault();
                const selection = window.getSelection();
                const range = selection.getRangeAt(0);

                // 4개의 공백 노드 생성
                const tabNode = document.createTextNode('\u00a0\u00a0\u00a0\u00a0'); // &nbsp;는 contenteditable에서 작동하지 않을 수 있으므로 유니코드 공백을 사용
                
                range.deleteContents();
                range.insertNode(tabNode);

                // 커서를 삽입된 공백 뒤로 이동
                range.setStartAfter(tabNode);
                range.setEndAfter(tabNode);
                selection.removeAllRanges();
                selection.addRange(range);
            }
            
            // 키 입력 시 바로 저장
            setTimeout(saveContent, 50); 
        });

        // 4. 입력 내용 변경 시 저장 이벤트 리스너 추가
        content.addEventListener('input', saveContent);


        content.addEventListener('paste', (event) => {
            const items = (event.clipboardData || event.originalEvent.clipboardData).items;
            let imagePasted = false;
            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf('image') !== -1) {
                    const file = items[i].getAsFile();
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const img = document.createElement('img');
                            img.src = e.target.result;
                            img.alt = '붙여넣은 이미지';
                            
                            const selection = window.getSelection();
                            if (selection.rangeCount > 0) {
                                const range = selection.getRangeAt(0);
                                range.deleteContents();
                                range.insertNode(img);
                                range.collapse(false);
                                
                                const br = document.createElement('br');
                                range.insertNode(br);
                                range.collapse(false);
                            } else {
                                content.appendChild(img);
                                content.appendChild(document.createElement('br'));
                            }
                            saveContent(); // 이미지 붙여넣기 후 내용 저장
                        };
                        reader.readAsDataURL(file);
                        event.preventDefault();
                        imagePasted = true;
                        break;
                    }
                }
            }
            if (!imagePasted) {
                // 이미지가 아닌 일반 텍스트 붙여넣기의 경우, 붙여넣기 완료 후 저장 호출
                setTimeout(saveContent, 0);
            }
        });

        window.onload = () => {
            loadFontSize(); // 저장된 폰트 크기 로드
            loadContent();  // 저장된 메모 내용 로드
            content.focus();
        };
    </script>
</body>
</html>
