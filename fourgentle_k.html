<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사군자탕 기반 처방</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Noto+Serif:wght@600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #F7F3EF;
            color: #4a4a4a;
            overflow-x: hidden;
        }
        .formula-item {
            background-color: #e9e2d9;
            color: #5a5a5a;
        }
        .formula-item.active {
            background-color: #A67B5B;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .central-orb {
            background: radial-gradient(circle, #A67B5B 0%, #6F5B3E 70%);
            box-shadow: 0 0 20px #C89F76, 0 0 40px #C89F76, inset 0 0 15px #e6c5a8;
        }
        .herb-orb {
            position: absolute;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1);
            opacity: 0;
            transform: scale(0);
            cursor: pointer;
        }
        .herb-orb.visible {
            opacity: 1;
            transform: scale(1);
        }
        .herb-orb.base {
            background: radial-gradient(circle, #D4A373, #A17C4F);
            box-shadow: 0 0 10px #D4A373, inset 0 0 5px #f3d8b7;
            color: white;
        }
        .herb-orb.added {
            background: radial-gradient(circle, #81A89D, #52796F);
            box-shadow: 0 0 10px #81A89D, inset 0 0 5px #bde0d9;
            color: white;
        }
        #modal-overlay {
            transition: opacity 0.3s ease;
        }
        #modal-content {
            transition: all 0.3s ease;
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <header style="width: 100%; max-width: 48rem; margin: 1rem auto; padding: 0 1rem; display: flex; justify-content: space-between; align-items: center;">
        <a href="index.html" style="font-family: 'Noto Serif', serif; font-size: 1.125rem; font-weight: 600; color: rgb(55, 65, 81); text-decoration: none;">
            &larr; Interactive TCM
        </a>
    </header>

    <main class="flex-grow">
        <div class="max-w-4xl mx-auto px-4">
            <header class="text-center mb-8">
                <br>
                <h1 class="text-3xl md:text-4xl font-semibold" style="color: #6B4F4B;">사군자탕 변방</h1>
            </header>

            <!-- Formula List -->
            <div class="p-4 rounded-2xl mb-8">
                <div id="formula-list" class="flex flex-wrap justify-center gap-2">
                     <!-- Formula list will be populated by JS -->
                </div>
            </div>

            <!-- Visualization Area -->
            <div class="bg-white/50 p-6 rounded-2xl shadow-lg min-h-[500px] flex flex-col justify-between">
                <div id="vis-container" class="relative w-full h-[400px] md:h-[450px]">
                    <div id="central-orb" class="central-orb absolute top-1/2 left-1/2 w-40 h-40 md:w-48 md:h-48 rounded-full flex flex-col items-center justify-center text-center -translate-x-1/2 -translate-y-1/2 transition-all duration-500">
                        <h2 id="info-title" class="text-2xl md:text-3xl font-bold text-white leading-tight"></h2>
                    </div>
                    <!-- Herb orbs will be populated here -->
                </div>
                <div id="info-panel" class="text-center mt-4">
                    <p id="info-derivation" class="text-lg text-amber-800 font-medium mb-2"></p>
                </div>
            </div>
        </div>
    </main>

    <!-- Herb Info Modal -->
    <div id="modal-overlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div id="modal-content" class="bg-[#F7F3EF] rounded-xl shadow-2xl p-6 w-full max-w-md transform scale-95 opacity-0 relative">
            <button id="modal-close-x" class="absolute top-3 right-4 text-gray-500 hover:text-gray-800 text-3xl leading-none font-light transition-colors">&times;</button>
            <h3 id="modal-title" class="text-2xl font-bold text-amber-900 mb-4 pr-8"></h3>
            <p id="modal-effects" class="text-gray-700"></p>
        </div>
    </div>

    <!-- Footer for Individual Pages -->
    <footer class="text-center py-8 mt-12 text-sm text-gray-500">
        <p>&copy; 2024 Hyungsuk Choi. All Rights Reserved.</p>
    </footer>

    <script>
        const allHerbs = [
            { id: 'ren-shen', name: '인삼', effects: '원기를 크게 보하고, 비장과 폐를 튼튼하게 하며, 진액을 생성하고 정신을 안정시킵니다.' },
            { id: 'bai-zhu', name: '백출', effects: '비장의 기를 보하고, 습기를 말리며, 외부의 사기를 막아줍니다.' },
            { id: 'fu-ling', name: '복령', effects: '소변을 통해 습기를 배출시키고, 비장을 보하며, 정신을 안정시킵니다.' },
            { id: 'gan-cao', name: '감초', effects: '비장의 기를 보하고, 폐를 촉촉하게 하며, 긴급한 증상을 완화하고 다른 약재를 조화시킵니다.' },
            { id: 'gan-jiang', name: '건강', effects: '중초를 따뜻하게 하고 한기를 몰아내며, 쇠약해진 양기를 회복시킵니다.' },
            { id: 'huang-qi', name: '황기', effects: '기와 혈을 보하고, 양기를 끌어올리며, 외부를 튼튼하게 합니다.' },
            { id: 'dang-gui', name: '당귀', effects: '혈을 보하고 활발하게 하며, 월경을 조절합니다.' },
            { id: 'chen-pi', name: '진피', effects: '기를 조절하고, 중초를 바로잡으며, 습기를 말리고 담을 삭입니다.' },
            { id: 'sheng-ma', name: '승마', effects: '양기를 끌어올리고, 탈출된 장기를 올리며, 열을 내리고 독을 풀어줍니다.' },
            { id: 'chai-hu', name: '시호', effects: '간의 기운을 퍼뜨리고, 울결된 것을 풀며, 표리와 내부를 조화시킵니다.' },
            { id: 'an-shen-yao', name: '안신약', effects: '심장을 자양하고 정신을 안정시켜 불면과 가슴 두근거림을 치료하는 약재의 분류입니다.' },
            { id: 'si-wu-tang', name: '사물탕', effects: '혈을 보하고 조절하는 기본적인 처방입니다.' },
            { id: 'rou-gui', name: '육계', effects: '신장, 비장, 심장을 따뜻하게 하고, 양기를 북돋우며, 깊은 한기를 흩어냅니다.' },
            { id: 'an-tai-yao', name: '안태약', effects: '태아를 안정시키고 유산을 방지하는 데 사용되는 약재의 분류입니다.' },
            { id: 'er-chen-tang', name: '이진탕', effects: '습기를 말리고, 담을 삭이며, 기를 조절하는 기본적인 처방입니다.' },
            { id: 'shan-yao', name: '산약', effects: '비장, 폐, 신장의 기와 음을 보합니다.' },
            { id: 'qu-shi-yao', name: '거습약', effects: '몸에서 습기를 빼내거나, 말리거나, 변화시키는 약재의 분류입니다.' }
        ];

        const formulas = {
            'si-jun-zi-tang': {
                name: '사군자탕',
                derivation_text: "비장의 기를 보하는 기본 처방입니다.",
                composition: { base: ['ren-shen', 'bai-zhu', 'fu-ling', 'gan-cao'], added: [] }
            },
            'li-zhong-wan': {
                name: '이중환',
                derivation_text: "복령 대신 건강을 사용하여 내부를 따뜻하게 합니다.",
                composition: { base: ['ren-shen', 'bai-zhu', 'gan-cao'], added: ['gan-jiang'] }
            },
            'bu-zhong-yi-qi-tang': {
                name: '보중익기탕',
                derivation_text: "양기를 강하게 끌어올리고 탈항을 치료하는 약재를 추가합니다.",
                composition: { base: ['ren-shen', 'bai-zhu', 'gan-cao'], added: ['huang-qi', 'dang-gui', 'chen-pi', 'sheng-ma', 'chai-hu'] }
            },
            'gui-pi-tang': {
                name: '귀비탕',
                derivation_text: "혈을 자양하고 정신을 안정시키는 약재를 추가합니다.",
                composition: { base: ['ren-shen', 'bai-zhu', 'fu-ling', 'gan-cao'], added: ['dang-gui', 'an-shen-yao', 'huang-qi'] }
            },
            'ba-zhen-tang': {
                name: '팔진탕',
                derivation_text: "사물탕과 합방하여 기와 혈을 모두 보합니다.",
                composition: { base: ['ren-shen', 'bai-zhu', 'fu-ling', 'gan-cao'], added: ['si-wu-tang'] }
            },
            'shi-quan-da-bu-tang': {
                name: '십전대보탕',
                derivation_text: "팔진탕에 따뜻한 약재를 더해 심한 허증을 치료합니다.",
                composition: { base: ['ren-shen', 'bai-zhu', 'fu-ling', 'gan-cao'], added: ['si-wu-tang', 'huang-qi', 'rou-gui'] }
            },
            'tai-shan-pan-shi-san': {
                name: '태산반석산',
                derivation_text: "팔진탕에 태아를 안정시키는 약재를 추가합니다.",
                composition: { base: ['ren-shen', 'bai-zhu', 'gan-cao'], added: ['si-wu-tang', 'an-tai-yao', 'huang-qi'] }
            },
            'liu-jun-zi-tang': {
                name: '육군자탕',
                derivation_text: "이진탕과 합방하여 담을 삭입니다.",
                composition: { base: ['ren-shen', 'bai-zhu', 'fu-ling', 'gan-cao'], added: ['er-chen-tang'] }
            },
            'yi-gong-san': {
                name: '이공산',
                derivation_text: "진피를 추가하여 기의 순환을 조절합니다.",
                composition: { base: ['ren-shen', 'bai-zhu', 'fu-ling', 'gan-cao'], added: ['chen-pi'] }
            },
            'shen-ling-bai-zhu-san': {
                name: '삼령백출산',
                derivation_text: "비장을 굳건히 하고 설사를 멈추게 하는 약재를 추가합니다.",
                composition: { base: ['ren-shen', 'bai-zhu', 'fu-ling', 'gan-cao'], added: ['shan-yao', 'qu-shi-yao'] }
            }
        };
        
        const visContainer = document.getElementById('vis-container');
        const formulaListEl = document.getElementById('formula-list');
        const infoTitle = document.getElementById('info-title');
        const infoDerivation = document.getElementById('info-derivation');
        
        const modalOverlay = document.getElementById('modal-overlay');
        const modalContent = document.getElementById('modal-content');
        const modalTitle = document.getElementById('modal-title');
        const modalEffects = document.getElementById('modal-effects');
        const modalCloseX = document.getElementById('modal-close-x');

        function initialize() {
            allHerbs.forEach(herb => {
                const orb = document.createElement('div');
                orb.id = `herb-${herb.id}`;
                orb.className = 'herb-orb';
                orb.textContent = herb.name;
                orb.addEventListener('click', () => showModal(herb));
                visContainer.appendChild(orb);
            });

            Object.keys(formulas).forEach(key => {
                const formula = formulas[key];
                const item = document.createElement('button');
                item.dataset.id = key;
                item.textContent = formula.name;
                item.className = 'formula-item font-medium py-2 px-4 rounded-full cursor-pointer transition-all duration-300 shadow-sm hover:shadow-md';
                item.addEventListener('click', () => updateDisplay(key));
                formulaListEl.appendChild(item);
            });
            
            modalOverlay.addEventListener('click', hideModal);
            modalCloseX.addEventListener('click', hideModal);
            modalContent.addEventListener('click', (e) => e.stopPropagation());

            updateDisplay('si-jun-zi-tang');
        }

        function showModal(herb) {
            modalTitle.textContent = herb.name;
            modalEffects.textContent = herb.effects;
            modalOverlay.classList.remove('hidden');
            setTimeout(() => {
                modalOverlay.classList.remove('opacity-0');
                modalContent.classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function hideModal() {
            modalOverlay.classList.add('opacity-0');
            modalContent.classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                modalOverlay.classList.add('hidden');
            }, 300);
        }

        function updateDisplay(formulaId) {
            const formula = formulas[formulaId];
            if (!formula) return;

            infoTitle.textContent = formula.name;
            infoDerivation.textContent = formula.derivation_text;

            document.querySelectorAll('.formula-item').forEach(item => {
                item.classList.toggle('active', item.dataset.id === formulaId);
            });

            const currentHerbs = [...new Set([...formula.composition.base, ...formula.composition.added])];
            const radius = Math.min(visContainer.clientWidth, visContainer.clientHeight) / 2 * 0.7;
            const angleStep = currentHerbs.length > 0 ? (2 * Math.PI) / currentHerbs.length : 0;

            let visibleHerbCount = 0;
            allHerbs.forEach(herb => {
                const orb = document.getElementById(`herb-${herb.id}`);
                if (currentHerbs.includes(herb.id)) {
                    orb.classList.add('visible');
                    orb.classList.toggle('base', formula.composition.base.includes(herb.id));
                    orb.classList.toggle('added', formula.composition.added.includes(herb.id));
                    
                    const angle = angleStep * visibleHerbCount - (Math.PI / 2);
                    const x = (visContainer.clientWidth / 2) + radius * Math.cos(angle) - (orb.clientWidth / 2);
                    const y = (visContainer.clientHeight / 2) + radius * Math.sin(angle) - (orb.clientHeight / 2);
                    orb.style.left = `${x}px`;
                    orb.style.top = `${y}px`;
                    visibleHerbCount++;
                } else {
                    orb.classList.remove('visible', 'base', 'added');
                }
            });
        }

        initialize();
        window.addEventListener('resize', () => {
            const activeFormula = document.querySelector('.formula-item.active')?.dataset.id || 'si-jun-zi-tang';
            updateDisplay(activeFormula);
        });
    </script>
</body>
</html>
