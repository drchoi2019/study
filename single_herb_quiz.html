<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>본초 효능 퀴즈 / Single Herb Quiz</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&family=Poppins:wght@400;500;700&display=swap');
        body {
            font-family: 'Noto Sans KR', 'Poppins', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            min-height: 100vh;
            background-color: #F7F3EF; /* 전체 배경색 수정 */
            margin: 0;
            padding: 1rem;
            box-sizing: border-box;
        }
        #page-header {
            width: 100%;
            max-width: 48rem;
            margin: 1rem auto;
            padding: 0 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #header-link {
            font-size: 1.125rem;
            font-weight: 600;
            color: rgb(55, 65, 81);
            text-decoration: none;
        }
        .lang-toggle-btn {
            background-color: #FFFFFF; /* 버튼 배경색은 흰색으로 변경하여 구분 */
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            font-weight: bold;
            color: #4A4A4A;
            border-radius: 0.375rem;
            transition: background-color 150ms ease-in-out;
            border: 1px solid #e2dcd7; /* 테두리 추가 */
            cursor: pointer;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .lang-toggle-btn:hover {
            background-color: #e2dcd7;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
            margin-top: 20px;
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
        }
        .quiz-header {
            display: flex;
            justify-content: flex-end; /* Timer to the right */
            align-items: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            color: #555;
        }
        #timer {
            font-weight: 700;
            color: #d9534f;
            background-color: #fdf2f2;
            padding: 5px 12px;
            border-radius: 20px;
        }
        .question-block {
            margin-bottom: 2.5rem;
            text-align: left;
        }
        .question-text {
            font-size: 1.2em;
            font-weight: 500;
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        .btn-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }
        .btn {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }
        .btn:hover:not(:disabled) {
            background-color: #e9ecef;
            border-color: #adb5bd;
        }
        .btn.selected {
            /* We will use 'wrong' class for selected but incorrect answers */
        }
        .btn.correct {
            background-color: #d4edda !important;
            color: #155724 !important;
            border-color: #c3e6cb !important;
        }
        .btn.wrong {
            background-color: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }
        .btn:disabled {
            cursor: not-allowed;
            opacity: 0.8;
        }
        .action-btn {
            font-size: 1.2em;
            font-weight: 700;
            padding: 12px 30px;
            cursor: pointer;
            border: none;
            border-radius: 8px;
            background-color: #007bff;
            color: white;
            width: 100%;
            margin-top: 20px;
        }
        .hide {
            display: none;
        }
    </style>
</head>
<body>
    <header id="page-header">
        <a href="index.html" id="header-link">
            &larr; Interactive TCM
        </a>
        <a href="#" onclick="toggleLanguage(event)" class="lang-toggle-btn" id="lang-toggle-button">
            Kor / Eng
        </a>
    </header>

    <div class="container">
        <div id="start-screen">
            <h1 data-key="quizTitle">본초 효능 퀴즈</h1>
            <p data-key="quizDescription" id="quiz-info"></p>
            <button id="start-btn" class="action-btn" data-key="startQuiz">퀴즈 시작</button>
        </div>

        <div id="quiz-screen" class="hide">
            <div class="quiz-header">
                <div id="timer"></div>
            </div>
            <div id="all-questions-container"></div>
            <button id="submit-btn" class="action-btn" data-key="submitQuiz">제출하기</button>
        </div>
        
        <div id="result-screen" class="hide">
            <h1 data-key="quizResultTitle">퀴즈 결과</h1>
            <p id="score-text"></p>
            <button id="restart-btn" class="action-btn" data-key="restartQuiz">다시하기</button>
        </div>
    </div>

    <script>
        const allQuestions = [
            { ko: { question: "다음 중 **육계 (Guizhi)**의 주요 효능으로 가장 알맞은 것은?", options: ["청열조습, 사화해독", "발한해표, 온경지통", "보기익기, 승양고표", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "화담지해, 강역지구"], answer: "발한해표, 온경지통" }, en: { question: "Which of the following is the most appropriate main efficacy of **Guizhi (Ramulus Cinnamomi)**?", options: ["Clears heat and dries dampness, purges fire and detoxifies", "Induces sweating to release the exterior, warms meridians to relieve pain", "Tonifies Qi and invigorates the spleen, lifts Yang and secures the exterior", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting"], answer: "Induces sweating to release the exterior, warms meridians to relieve pain" } },
            { ko: { question: "다음 중 **건강 (Shengjiang)**의 주요 효능으로 가장 알맞은 것은?", options: ["보기건비, 이수삼습", "온중산한, 해표지한", "청열사화, 해독소종", "자음윤폐, 생진지갈", "활혈조경, 지통산결", "화담지해, 강역지구"], answer: "온중산한, 해표지한" }, en: { question: "Which of the following is the most appropriate main efficacy of **Shengjiang (dried)**?", options: ["Tonifies Qi and strengthens the spleen, promotes urination and resolves dampness", "Warms the middle and dispels cold, releases the exterior to relieve pain", "Clears heat and purges fire, detoxifies and reduces swelling", "Nourishes Yin and moistens the lungs, generates fluids to quench thirst", "Invigorates blood to regulate menstruation, relieves pain and dissipates nodules", "Transforms phlegm and stops cough, descends Qi to relieve vomiting"], answer: "Warms the middle and dispels cold, releases the exterior to relieve pain" } },
            { ko: { question: "다음 중 **황기 (Huangqi)**의 주요 효능으로 가장 알맞은 것은?", options: ["보기익기, 승양고표", "청열해독, 제습소종", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "화담지해, 강역지구", "사하통변, 윤조연견"], answer: "보기익기, 승양고표" }, en: { question: "Which of the following is the most appropriate main efficacy of **Huangqi (Astragalus Root)**?", options: ["Tonifies Qi and invigorates Qi, lifts Yang and secures the exterior", "Clears heat and detoxifies, resolves dampness and reduces swelling", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Purges and unblocks bowels, moistens dryness and softens hardness"], answer: "Tonifies Qi and invigorates Qi, lifts Yang and secures the exterior" } },
            { ko: { question: "다음 중 **인삼 (Renshen)**의 주요 효능으로 가장 알맞은 것은?", options: ["보기익기, 생진안신", "청열사화, 제습소종", "보혈조경, 활혈지통", "자음윤조, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "보기익기, 생진안신" }, en: { question: "Which of the following is the most appropriate main efficacy of **Renshen (Ginseng)**?", options: ["Tonifies Qi and invigorates Qi, generates fluids and calms the spirit", "Clears heat and purges fire, resolves dampness and reduces swelling", "Nourishes blood to regulate menstruation, invigorates blood and relieves pain", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Tonifies Qi and invigorates Qi, generates fluids and calms the spirit" } },
            { ko: { question: "다음 중 **백출 (Baizhu)**의 주요 효능으로 가장 알맞은 것은?", options: ["보기건비, 조습이수", "청열사화, 해독소종", "보혈조경, 윤조활혈", "자음윤폐, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "보기건비, 조습이수" }, en: { question: "Which of the following is the most appropriate main efficacy of **Baizhu (Cangzhu) (White Atractylodes Root)**?", options: ["Tonifies Qi and strengthens the spleen, dries dampness and promotes urination", "Clears heat and purges fire, detoxifies and reduces swelling", "Nourishes blood to regulate menstruation, moistens dryness and invigorates blood", "Nourishes Yin and moistens the lungs, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Tonifies Qi and strengthens the spleen, dries dampness and promotes urination" } },
            { ko: { question: "다음 중 **복령 (Fuling)**의 주요 효능으로 가장 알맞은 것은?", options: ["보기건비, 이수삼습", "청열해독, 제습소종", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "보기건비, 이수삼습" }, en: { question: "Which of the following is the most appropriate main efficacy of **Fuling (Poria)**?", options: ["Tonifies Qi and strengthens the spleen, promotes urination and resolves dampness", "Clears heat and detoxifies, resolves dampness and reduces swelling", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Tonifies Qi and strengthens the spleen, promotes urination and resolves dampness" } },
            { ko: { question: "다음 중 **숙지황 (Shudihuang)**의 주요 효능으로 가장 알맞은 것은?", options: ["보혈자음, 익정전수", "보기익기, 고표지한", "청열사화, 해독소종", "자음윤조, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "보혈자음, 익정전수" }, en: { question: "Which of the following is the most appropriate main efficacy of **Shudihuang (Processed Rehmannia Root)**?", options: ["Nourishes blood and Yin, benefits essence and marrow", "Tonifies Qi and invigorates Qi, stabilizes the exterior and stops sweating", "Clears heat and purges fire, detoxifies and reduces swelling", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Nourishes blood and Yin, benefits essence and marrow" } },
            { ko: { question: "다음 중 **당귀 (Danggui)**의 주요 효능으로 가장 알맞은 것은?", options: ["보혈조경, 활혈지통", "청열조습, 제습소종", "보기익기, 건비이수", "자음윤조, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "보혈조경, 활혈지통" }, en: { question: "Which of the following is the most appropriate main efficacy of **Danggui (Angelica Sinensis Root)**?", options: ["Nourishes blood to regulate menstruation, invigorates blood to relieve pain", "Clears heat and dries dampness, resolves dampness and reduces swelling", "Tonifies Qi and invigorates Qi, strengthens the spleen and promotes urination", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Nourishes blood to regulate menstruation, invigorates blood to relieve pain" } },
            { ko: { question: "다음 중 **백작약 (Baishao)**의 주요 효능으로 가장 알맞은 것은?", options: ["양혈유간, 완급지통", "보기건비, 이수삼습", "청열해독, 사화소종", "자음윤조, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "양혈유간, 완급지통" }, en: { question: "Which of the following is the most appropriate main efficacy of **Baishao (Chishao) (White Peony Root)**?", options: ["Nourishes blood and soothes the liver, alleviates spasms and pain", "Tonifies Qi and strengthens the spleen, promotes urination and resolves dampness", "Clears heat and detoxifies, purges fire and reduces swelling", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Nourishes blood and soothes the liver, alleviates spasms and pain" } },
            { ko: { question: "다음 중 **천궁 (Chuanxiong)**의 주요 효능으로 가장 알맞은 것은?", options: ["활혈행기, 거풍지통", "보기익기, 승양고표", "청열해독, 제습소종", "자음윤조, 생진지갈", "화담지해, 강역지구", "사하통변, 윤조연견"], answer: "활혈행기, 거풍지통" }, en: { question: "Which of the following is the most appropriate main efficacy of **Chuanxiong (Chuan Xiong Rhizome)**?", options: ["Invigorates blood and moves Qi, dispels wind and relieves pain", "Tonifies Qi and invigorates Qi, lifts Yang and secures the exterior", "Clears heat and detoxifies, resolves dampness and reduces swelling", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Purges and unblocks bowels, moistens dryness and softens hardness"], answer: "Invigorates blood and moves Qi, dispels wind and relieves pain" } },
            { ko: { question: "다음 중 **황금 (Huangqin)**의 주요 효능으로 가장 알맞은 것은?", options: ["청열조습, 사화해독", "보기익기, 건비이수", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "청열조습, 사화해독" }, en: { question: "Which of the following is the most appropriate main efficacy of **Huangqin (Scutellaria Root)**?", options: ["Clears heat and dries dampness, purges fire and detoxifies", "Tonifies Qi and invigorates Qi, strengthens the spleen and promotes urination", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Clears heat and dries dampness, purges fire and detoxifies" } },
            { ko: { question: "다음 중 **황련 (Huanglian)**의 주요 효능으로 가장 알맞은 것은?", options: ["청열조습, 사화해독", "보기건비, 이수삼습", "보혈조경, 윤조활혈", "자음윤조, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "청열조습, 사화해독" }, en: { question: "Which of the following is the most appropriate main efficacy of **Huanglian (Coptis Rhizome)**?", options: ["Clears heat and dries dampness, purges fire and detoxifies", "Tonifies Qi and strengthens the spleen, promotes urination and resolves dampness", "Nourishes blood to regulate menstruation, moistens dryness and invigorates blood", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Clears heat and dries dampness, purges fire and detoxifies" } },
            { ko: { question: "다음 중 **금은화 (Jinyinhua)**의 주요 효능으로 가장 알맞은 것은?", options: ["청열해독, 소종산결", "보기익기, 건비이수", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "청열해독, 소종산결" }, en: { question: "Which of the following is the most appropriate main efficacy of **Jinyinhua (Honeysuckle Flower)**?", options: ["Clears heat and detoxifies, reduces swelling and dissipates nodules", "Tonifies Qi and invigorates Qi, strengthens the spleen and promotes urination", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Clears heat and detoxifies, reduces swelling and dissipates nodules" } },
            { ko: { question: "다음 중 **연교 (Lianqiao)**의 주요 효능으로 가장 알맞은 것은?", options: ["청열해독, 소종산결", "보기익기, 건비이수", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "화담지해, 강역지구", "사하통변, 윤조연견"], answer: "청열해독, 소종산결" }, en: { question: "Which of the following is the most appropriate main efficacy of **Lianqiao (Forsythia Fruit)**?", options: ["Clears heat and detoxifies, reduces swelling and dissipates nodules", "Tonifies Qi and invigorates Qi, strengthens the spleen and promotes urination", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Purges and unblocks bowels, moistens dryness and softens hardness"], answer: "Clears heat and detoxifies, reduces swelling and dissipates nodules" } },
            { ko: { question: "다음 중 **석고 (Shigao)**의 주요 효능으로 가장 알맞은 것은?", options: ["청열사화, 생진지갈", "보기건비, 이수삼습", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "청열사화, 생진지갈" }, en: { question: "Which of the following is the most appropriate main efficacy of **Shigao (Gypsum Fibrosum)**?", options: ["Clears heat and purges fire, generates fluids to quench thirst", "Tonifies Qi and strengthens the spleen, promotes urination and resolves dampness", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Clears heat and purges fire, generates fluids to quench thirst" } },
            { ko: { question: "다음 중 **생지황 (Shengdihuang)**의 주요 효능으로 가장 알맞은 것은?", options: ["청열량혈, 자음생진", "보기익기, 건비이수", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "화담지해, 강역지구", "사하통변, 윤조연견"], answer: "청열량혈, 자음생진" }, en: { question: "Which of the following is the most appropriate main efficacy of **Shengdihuang (Fresh Rehmannia Root)**?", options: ["Clears heat and cools blood, nourishes Yin and generates fluids", "Tonifies Qi and invigorates Qi, strengthens the spleen and promotes urination", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Purges and unblocks bowels, moistens dryness and softens hardness"], answer: "Clears heat and cools blood, nourishes Yin and generates fluids" } },
            { ko: { question: "다음 중 **오미자 (Wuweizi)**의 주요 효능으로 가장 알맞은 것은?", options: ["렴폐지해, 생진지갈", "보기익기, 건비이수", "청열해독, 제습소종", "보혈조경, 활혈거어", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "렴폐지해, 생진지갈" }, en: { question: "Which of the following is the most appropriate main efficacy of **Wuweizi (Schisandra Fruit)**?", options: ["Restrains lung Qi and stops cough, generates fluids to quench thirst", "Tonifies Qi and invigorates Qi, strengthens the spleen and promotes urination", "Clears heat and detoxifies, resolves dampness and reduces swelling", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Restrains lung Qi and stops cough, generates fluids to quench thirst" } },
            { ko: { question: "다음 중 **맥문동 (Maimendong)**의 주요 효능으로 가장 알맞은 것은?", options: ["자음윤폐, 생진지갈", "보기익기, 승양고표", "청열조습, 사화해독", "보혈조경, 활혈거어", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "자음윤폐, 생진지갈" }, en: { question: "Which of the following is the most appropriate main efficacy of **Maimendong (Ophiopogon Root)**?", options: ["Nourishes Yin and moistens the lungs, generates fluids to quench thirst", "Tonifies Qi and invigorates Qi, lifts Yang and secures the exterior", "Clears heat and dries dampness, purges fire and detoxifies", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Nourishes Yin and moistens the lungs, generates fluids to quench thirst" } },
            { ko: { question: "다음 중 **갈근 (Gegen)**의 주요 효능으로 가장 알맞은 것은?", options: ["해기생진, 승양지사", "보기익기, 건비이수", "청열해독, 제습소종", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "온리거한, 회양구역"], answer: "해기생진, 승양지사" }, en: { question: "Which of the following is the most appropriate main efficacy of **Gegen (Pueraria Root)**?", options: ["Releases the exterior and generates fluids, lifts Yang and stops diarrhea", "Tonifies Qi and invigorates Qi, strengthens the spleen and promotes urination", "Clears heat and detoxifies, resolves dampness and reduces swelling", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Releases the exterior and generates fluids, lifts Yang and stops diarrhea" } },
            { ko: { question: "다음 중 **반하 (Banxia)**의 주요 효능으로 가장 알맞은 것은?", options: ["조습화담, 강역지구", "보기익기, 건비이수", "청열해독, 제습소종", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "온리거한, 회양구역"], answer: "조습화담, 강역지구" }, en: { question: "Which of the following is the most appropriate main efficacy of **Banxia (Pinellia Tuber)**?", options: ["Dries dampness and transforms phlegm, descends rebellious Qi to stop vomiting", "Tonifies Qi and invigorates Qi, strengthens the spleen and promotes urination", "Clears heat and detoxifies, resolves dampness and reduces swelling", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Dries dampness and transforms phlegm, descends rebellious Qi to stop vomiting" } },
            { ko: { question: "다음 중 **시호 (Chaihu)**의 주요 효능으로 가장 알맞은 것은?", options: ["소간해울, 승양거함", "보기익기, 건비이수", "청열해독, 제습소종", "보혈조경, 활혈거어", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "소간해울, 승양거함" }, en: { question: "Which of the following is the most appropriate main efficacy of **Chaihu (Bupleurum Root)**?", options: ["Spreads liver Qi and resolves stagnation, lifts Yang and raises what has sunken", "Tonifies Qi and invigorates Qi, strengthens the spleen and promotes urination", "Clears heat and detoxifies, resolves dampness and reduces swelling", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Spreads liver Qi and resolves stagnation, lifts Yang and raises what has sunken" } },
            { ko: { question: "다음 중 **대황 (Dahuang)**의 주요 효능으로 가장 알맞은 것은?", options: ["사하통변, 청열해독", "보기익기, 건비이수", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "화담지해, 강역지구", "온리거한, 회양구역"], answer: "사하통변, 청열해독" }, en: { question: "Which of the following is the most appropriate main efficacy of **Dahuang (Rhubarb Root)**?", options: ["Purges and unblocks bowels, clears heat and detoxifies", "Tonifies Qi and invigorates Qi, strengthens the spleen and promotes urination", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting", "Warms the interior to dispel cold, restores Yang and rescues from collapse"], answer: "Purges and unblocks bowels, clears heat and detoxifies" } },
            { ko: { question: "다음 중 **부자 (Fuzi)**의 주요 효능으로 가장 알맞은 것은?", options: ["회양구역, 보화산한", "보기익기, 승양고표", "청열해독, 제습소종", "보혈조경, 활혈거어", "자음윤조, 생진지갈", "화담지해, 강역지구"], answer: "회양구역, 보화산한" }, en: { question: "Which of the following is the most appropriate main efficacy of **Fuzi (Aconite Root)**?", options: ["Restores Yang and rescues from collapse, tonifies fire and disperses cold", "Tonifies Qi and invigorates Qi, lifts Yang and secures the exterior", "Clears heat and detoxifies, resolves dampness and reduces swelling", "Nourishes blood to regulate menstruation, invigorates blood to remove stasis", "Nourishes Yin and moistens dryness, generates fluids to quench thirst", "Transforms phlegm and stops cough, descends Qi to relieve vomiting"], answer: "Restores Yang and rescues from collapse, tonifies fire and disperses cold" } }
        ];

        const translations = {
            ko: {
                quizTitle: "본초 효능 퀴즈",
                startQuiz: "퀴즈 시작",
                submitQuiz: "결과 확인",
                quizResultTitle: "퀴즈 결과",
                questionsCorrect: (correct, total) => `${total} 문제 중 ${correct} 문제를 맞혔습니다!`,
                restartQuiz: "다시하기",
                timeLeft: "남은 시간: ",
                quizDescription: (total, time) => `총 ${total}문제가 모두 표시됩니다.<br>전체 제한 시간은 ${time}초입니다 (문제당 10초).`
            },
            en: {
                quizTitle: "Single Herb Quiz",
                startQuiz: "Start Quiz",
                submitQuiz: "Check Answers",
                quizResultTitle: "Quiz Results",
                questionsCorrect: (correct, total) => `You got ${correct} out of ${total} questions correct!`,
                restartQuiz: "Restart Quiz",
                timeLeft: "Time Left: ",
                quizDescription: (total, time) => `All ${total} questions are displayed.<br>The total time limit is ${time} seconds (10 seconds per question).`
            }
        };

        const startScreen = document.getElementById('start-screen');
        const quizScreen = document.getElementById('quiz-screen');
        const resultScreen = document.getElementById('result-screen');
        const startBtn = document.getElementById('start-btn');
        const restartBtn = document.getElementById('restart-btn');
        const submitBtn = document.getElementById('submit-btn');
        const allQuestionsContainer = document.getElementById('all-questions-container');
        const timerElement = document.getElementById('timer');
        const scoreText = document.getElementById('score-text');
        
        let shuffledQuestions, score, timerInterval, quizTimeout, timeLeft;
        let currentLanguage = 'ko';

        function updateUrlParameter(key, value) {
            const url = new URL(window.location);
            url.searchParams.set(key, value);
            window.history.pushState({}, '', url);
        }

        function getLanguageFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const lang = urlParams.get('lang');
            if (lang === 'en' || lang === 'ko') {
                currentLanguage = lang;
            }
        }

        function updateTextContent() {
            document.querySelectorAll('[data-key]').forEach(element => {
                const key = element.getAttribute('data-key');
                if (translations[currentLanguage][key]) {
                    if (typeof translations[currentLanguage][key] === 'function') {
                        // Functions are handled separately, e.g., score
                    } else {
                        element.innerHTML = translations[currentLanguage][key];
                    }
                }
            });
            const totalQuestions = allQuestions.length;
            const totalTime = totalQuestions * 10;
            document.getElementById('quiz-info').innerHTML = translations[currentLanguage].quizDescription(totalQuestions, totalTime);
            updateTimerDisplay(totalTime, true); // initial display
        }
        
        function toggleLanguage(event) {
            event.preventDefault();
            currentLanguage = (currentLanguage === 'ko') ? 'en' : 'ko';
            updateUrlParameter('lang', currentLanguage);
            updateTextContent();
            if(!quizScreen.classList.contains('hide') && resultScreen.classList.contains('hide')){
                renderAllQuestions(); // Re-render questions if quiz is active
            }
        }

        function startQuiz() {
            startScreen.classList.add('hide');
            resultScreen.classList.add('hide');
            quizScreen.classList.remove('hide');

            shuffledQuestions = [...allQuestions].sort(() => Math.random() - 0.5);
            score = 0;
            const totalTime = shuffledQuestions.length * 10;
            timeLeft = totalTime;

            renderAllQuestions();
            startTimer(totalTime);
        }

        function renderAllQuestions() {
            allQuestionsContainer.innerHTML = '';
            shuffledQuestions.forEach((questionData, index) => {
                const questionLang = questionData[currentLanguage];
                const questionBlock = document.createElement('div');
                questionBlock.className = 'question-block';

                const questionTextEl = document.createElement('p');
                questionTextEl.className = 'question-text';
                questionTextEl.innerHTML = `${index + 1}. ${questionLang.question.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}`;
                
                const answerGrid = document.createElement('div');
                answerGrid.className = 'btn-grid';

                const shuffledOptions = [...questionLang.options].sort(() => Math.random() - 0.5);

                shuffledOptions.forEach(option => {
                    const button = document.createElement('button');
                    button.innerText = option;
                    button.classList.add('btn');
                    button.dataset.questionIndex = index;
                    if (option === questionLang.answer) {
                        button.dataset.correct = true;
                    }
                    button.addEventListener('click', selectAnswer);
                    answerGrid.appendChild(button);
                });

                questionBlock.appendChild(questionTextEl);
                questionBlock.appendChild(answerGrid);
                allQuestionsContainer.appendChild(questionBlock);
            });
        }
        
        function selectAnswer(e) {
            const selectedButton = e.target;
            const questionIndex = selectedButton.dataset.questionIndex;
            const questionBlock = selectedButton.closest('.question-block');
            const buttonsForQuestion = questionBlock.querySelectorAll('.btn');
            
            // Disable all buttons for this question to prevent changing the answer
            buttonsForQuestion.forEach(btn => {
                btn.disabled = true;
                btn.classList.remove('selected'); 
            });

            // Mark the clicked button as selected
            selectedButton.classList.add('selected');

            // Find the correct button within the same question block
            const correctButton = questionBlock.querySelector('.btn[data-correct="true"]');
            
            // Always highlight the correct answer
            correctButton.classList.add('correct');

            // If the user's selection was not the correct one, mark it as wrong
            if (selectedButton.dataset.correct !== 'true') {
                selectedButton.classList.add('wrong');
            }
        }

        function startTimer(duration) {
            timeLeft = duration;
            updateTimerDisplay(timeLeft);
            
            quizTimeout = setTimeout(showResults, duration * 1000);
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay(timeLeft);
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                }
            }, 1000);
        }
        
        function updateTimerDisplay(time, initial = false) {
             const minutes = Math.floor(time / 60);
             const seconds = time % 60;
             const prefix = initial ? "" : translations[currentLanguage].timeLeft;
             timerElement.innerText = `${prefix}${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function showResults() {
            clearTimeout(quizTimeout);
            clearInterval(timerInterval);

            score = 0;
            shuffledQuestions.forEach((questionData, index) => {
                const questionBlock = allQuestionsContainer.children[index];
                const buttons = questionBlock.querySelectorAll('.btn');
                
                let isAnswered = false;
                buttons.forEach(button => {
                    if (button.classList.contains('selected')) {
                        isAnswered = true;
                    }
                });
                
                // If answered, check if correct
                const selectedButton = questionBlock.querySelector('.btn.selected');
                if (selectedButton && selectedButton.dataset.correct === 'true') {
                    score++;
                }

                // For all questions (answered or not), reveal the correct answer and disable all buttons
                buttons.forEach(button => {
                    button.disabled = true;
                    if (button.dataset.correct === 'true') {
                        button.classList.add('correct');
                    }
                });
            });

            quizScreen.classList.add('hide');
            resultScreen.classList.remove('hide');
            scoreText.innerText = translations[currentLanguage].questionsCorrect(score, shuffledQuestions.length);
        }

        startBtn.addEventListener('click', startQuiz);
        submitBtn.addEventListener('click', showResults);
        restartBtn.addEventListener('click', () => {
             resultScreen.classList.add('hide');
             startScreen.classList.remove('hide');
             updateTextContent();
        });
        
        window.addEventListener('DOMContentLoaded', () => {
            getLanguageFromUrl();
            updateTextContent();
        });
    </script>
</body>
</html>

