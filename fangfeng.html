<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방풍(防風): 해표 그 이상의 의미</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@400;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #fdfbf7; /* 한지 느낌의 미색 배경 */
            color: #2c3e50;
        }

        .serif {
            font-family: 'Noto Serif KR', serif;
        }

        /* Custom Animations */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
            100% { transform: translateY(0px); }
        }

        @keyframes pulse-ring {
            0% { transform: scale(0.8); opacity: 0.5; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
            70% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { transform: scale(0.8); opacity: 0.5; box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }

        @keyframes flowUp {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .animate-flow {
            animation: flowUp 0.6s ease-out forwards;
        }

        .marker-pulse::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        /* Herb visual style */
        .herb-texture {
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.1' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .active-tab {
            border-bottom: 2px solid #059669;
            color: #059669;
            font-weight: 700;
        }
        
        .inactive-tab {
            color: #6b7280;
            border-bottom: 2px solid transparent;
        }
        
        .inactive-tab:hover {
            color: #374151;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col herb-texture">

    <!-- Header -->
    <header class="w-full bg-white/90 backdrop-blur-sm border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-emerald-700 rounded-full flex items-center justify-center text-white font-bold serif text-xl shadow-lg">防</div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold text-emerald-900 serif">방제학에서 해표제의 이해</h1>
                    <p class="text-xs text-stone-500">해표(解表)를 넘어 승양(升陽)과 인경(引經)으로</p>
                </div>
            </div>
            <button onclick="toggleInfoModal()" class="hidden md:flex items-center gap-2 text-sm text-emerald-700 font-medium hover:bg-emerald-50 px-3 py-2 rounded-lg transition-colors">
                <i data-lucide="book-open" class="w-4 h-4"></i>
                방제학의 본질
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-6xl mx-auto w-full p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">
        
        <!-- Left Column: Navigation & Concept (4 cols) -->
        <div class="lg:col-span-4 flex flex-col gap-4">
            <!-- Intro Card -->
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-stone-100">
                <h2 class="text-lg font-bold text-stone-800 mb-2 flex items-center gap-2">
                    <i data-lucide="wind" class="text-emerald-500"></i>
                    해표제의 해석
                </h2>
                <!-- Text Removed as requested -->
                
                <!-- Tab Navigation for Mobile (and Desktop List) -->
                <div class="flex flex-col gap-2 mt-4" id="prescriptionList">
                    <!-- Buttons generated by JS -->
                </div>
            </div>

             <!-- Mobile Only 'Philosophy' Button -->
             <button onclick="toggleInfoModal()" class="md:hidden w-full bg-stone-800 text-white p-4 rounded-xl shadow-lg flex justify-center items-center gap-2">
                <i data-lucide="lightbulb" class="w-5 h-5"></i>
                방제학의 본질 읽기
            </button>
        </div>

        <!-- Right Column: Interactive Visual & Detail (8 cols) -->
        <div class="lg:col-span-8 flex flex-col gap-6 relative">
            
            <!-- Visualization Area -->
            <div class="bg-gradient-to-br from-white to-emerald-50/50 rounded-3xl shadow-xl border border-white relative overflow-hidden min-h-[500px] flex flex-col md:flex-row transition-all duration-500" id="mainDisplay">
                
                <!-- Human Silhouette & Markers -->
                <div class="w-full md:w-1/2 relative h-[400px] md:h-auto flex items-center justify-center p-8">
                    <!-- Body Shape (SVG) -->
                    <svg viewBox="0 0 200 400" class="h-full w-auto drop-shadow-2xl opacity-80">
                        <path d="M100,20 C115,20 125,30 125,45 C125,55 120,60 115,65 L135,75 L130,140 L110,120 L110,220 L125,380 L75,380 L90,220 L90,120 L70,140 L65,75 L85,65 C80,60 75,55 75,45 C75,30 85,20 100,20 Z" fill="#e5e7eb" stroke="#d1d5db" stroke-width="2"/>
                    </svg>

                    <!-- Dynamic Markers (Absolute Positioned) -->
                    <!-- Head -->
                    <div id="marker-head" class="marker absolute top-[12%] left-[50%] -translate-x-1/2 transition-all duration-500 opacity-30 scale-75">
                        <div class="w-8 h-8 bg-red-400 rounded-full flex items-center justify-center text-white shadow-lg marker-pulse">
                            <i data-lucide="brain" class="w-4 h-4"></i>
                        </div>
                    </div>
                    <!-- Mouth -->
                    <div id="marker-mouth" class="marker absolute top-[18%] left-[50%] -translate-x-1/2 transition-all duration-500 opacity-30 scale-75">
                        <div class="w-8 h-8 bg-orange-400 rounded-full flex items-center justify-center text-white shadow-lg marker-pulse">
                            <i data-lucide="smile" class="w-4 h-4"></i>
                        </div>
                    </div>
                    <!-- Skin/Surface (Chest area but representing surface) -->
                    <div id="marker-skin" class="marker absolute top-[30%] left-[65%] transition-all duration-500 opacity-30 scale-75">
                        <div class="w-8 h-8 bg-sky-400 rounded-full flex items-center justify-center text-white shadow-lg marker-pulse">
                            <i data-lucide="shield" class="w-4 h-4"></i>
                        </div>
                    </div>
                     <!-- Abdomen -->
                     <div id="marker-abdomen" class="marker absolute top-[45%] left-[50%] -translate-x-1/2 transition-all duration-500 opacity-30 scale-75">
                        <div class="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center text-white shadow-lg marker-pulse">
                            <i data-lucide="activity" class="w-4 h-4"></i>
                        </div>
                    </div>
                     <!-- General Body/Skin (Dermatology) -->
                     <div id="marker-body" class="marker absolute top-[35%] left-[30%] transition-all duration-500 opacity-30 scale-75">
                        <div class="w-8 h-8 bg-pink-400 rounded-full flex items-center justify-center text-white shadow-lg marker-pulse">
                            <i data-lucide="droplets" class="w-4 h-4"></i>
                        </div>
                    </div>

                    <!-- Energy Flow Arrows (SVG Overlay) -->
                    <svg id="energy-flow" class="absolute inset-0 w-full h-full pointer-events-none" style="z-index: 10;">
                        <!-- Arrows will be drawn here dynamically or pre-set -->
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                              <polygon points="0 0, 10 3.5, 0 7" fill="#10b981" />
                            </marker>
                        </defs>
                        <!-- Dynamic Paths -->
                        <path id="path-line" d="" fill="none" stroke="#10b981" stroke-width="3" stroke-dasharray="10,5" marker-end="url(#arrowhead)" class="hidden opacity-0 transition-opacity duration-500" />
                    </svg>
                </div>

                <!-- Info Panel -->
                <div class="w-full md:w-1/2 p-6 md:p-8 flex flex-col justify-center bg-white/60 backdrop-blur-md border-t md:border-t-0 md:border-l border-white">
                    <div id="info-content" class="animate-flow">
                        <div class="inline-block px-3 py-1 bg-emerald-100 text-emerald-800 rounded-full text-xs font-bold mb-4">
                            처방을 선택해주세요
                        </div>
                        <h2 class="text-3xl font-bold serif text-stone-800 mb-4">방풍의 에너지 흐름</h2>
                        <p class="text-stone-600 leading-relaxed">
                            좌측 메뉴에서 처방을 선택하여 방풍이 신체의 어느 부위로 기운을 이끌고(인경), 어떤 작용을 하는지 확인해보세요.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Context Hint -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 flex items-start gap-3">
                <i data-lucide="info" class="w-5 h-5 text-yellow-600 mt-1 flex-shrink-0"></i>
                <p class="text-sm text-yellow-800">
                    <strong>포인트:</strong> 방풍이 들어갔다고 해서 모두 '감기약'이 아닙니다. 각 처방에서 방풍은 다른 약재와 결합하여 '상승', '발산', '보호'의 에너지를 특정 장소로 배달합니다.
                </p>
            </div>
        </div>
    </main>
    
    <!-- Footer -->
    <footer class="w-full text-center py-6 text-stone-400 text-xs font-light">
        © 2024 Hyungsuk Choi. All Rights Reserved.
    </footer>

    <!-- Modal for Philosophy (Hidden by default) -->
    <div id="philosophyModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] hidden opacity-0 transition-opacity duration-300 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl transform scale-95 transition-transform duration-300" id="modalContent">
            <div class="p-6 md:p-8 relative">
                <button onclick="toggleInfoModal()" class="absolute top-4 right-4 p-2 hover:bg-stone-100 rounded-full transition-colors">
                    <i data-lucide="x" class="w-6 h-6 text-stone-400"></i>
                </button>
                
                <h2 class="text-2xl font-bold serif text-stone-800 mb-6 flex items-center gap-2">
                    <span class="w-8 h-8 bg-stone-800 text-white rounded-lg flex items-center justify-center text-sm">壹</span>
                    방제학의 본질: 약재 에너지의 조합
                </h2>
                
                <div class="prose prose-stone max-w-none">
                    <div class="bg-stone-50 p-6 rounded-xl mb-6 border-l-4 border-stone-800">
                        <p class="font-bold text-stone-700 text-lg mb-2">"해표제 = 감기약?"</p>
                        <p class="text-stone-600">
                            현대 방제학 교과서에서 해표제가 들어가면 획일적으로 부표(浮表)하는 맥이 나타나 표증(表證)이라고 단정하는 것은, 각 약재의 성질과 그 <strong>에너지(氣)</strong>의 조합을 간과하는 지나치게 단순한 해석입니다.
                        </p>
                    </div>

                    <h3 class="text-lg font-bold text-emerald-800 mb-2">방풍(防風) 에너지의 핵심</h3>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-start gap-3">
                            <i data-lucide="arrow-up-right" class="w-5 h-5 text-emerald-600 mt-1"></i>
                            <span class="text-stone-700"><strong>승산(升散):</strong> 위로 올리고 밖으로 흩뿌리는 힘.</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i data-lucide="shield-check" class="w-5 h-5 text-emerald-600 mt-1"></i>
                            <span class="text-stone-700"><strong>거풍(去風):</strong> 머무르는 사기(바람)를 몰아내는 힘.</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i data-lucide="map-pin" class="w-5 h-5 text-emerald-600 mt-1"></i>
                            <span class="text-stone-700"><strong>인경(引經):</strong> 이 에너지를 다른 약재와 조합하여 특정 부위(피부, 머리, 소화기, 입)로 유도하는 기술.</span>
                        </li>
                    </ul>

                    <p class="text-stone-600 leading-relaxed">
                        방제학의 진정한 공부는 단순히 효능을 나열하는 것이 아닙니다. 각 약재가 가진 양(陽)의 성질을 이해하고, 이 에너지를 어떻게 조합하여 효과를 극대화할 것인가를 탐구하는 데 있습니다.
                    </p>
                </div>

                <div class="mt-8 pt-6 border-t border-stone-100 flex justify-end">
                    <button onclick="toggleInfoModal()" class="px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors">
                        이해했습니다
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data Source
        const prescriptions = [
            {
                id: 'sahuangsan',
                name: '사황산(瀉黃散)',
                targetArea: '잇몸(상부), 비위',
                ingredients: '석고, 지자, <span class="font-bold text-emerald-600">방풍</span>, 곽향, 감초',
                markerId: 'marker-mouth',
                color: 'bg-orange-100 text-orange-800',
                btnColor: 'hover:bg-orange-50 hover:border-orange-200',
                icon: 'smile',
                coordinates: 'M 100 220 C 100 180 100 100 100 65', // Abdomen to Mouth (Upward)
                description: '상초(上焦)의 숨은 열을 찾아 끄다',
                detail: `
                    <h3 class="text-xl font-bold text-orange-700 mb-2">잇몸 염증 & 구내염</h3>
                    <p class="text-stone-600 mb-4"><strong>주 효능:</strong> 잇몸의 염증, 출혈, 입 냄새 등 비위(소화기)에 잠복한 화열(火熱)을 치료합니다.</p>
                    <div class="bg-white p-4 rounded-lg border border-orange-100 shadow-sm">
                        <h4 class="font-bold text-sm text-stone-500 mb-1">방풍의 역할 (인경)</h4>
                        <p class="text-stone-800">
                            약기운을 <span class="text-orange-600 font-bold">상부의 구강 및 잇몸</span> 부위로 인도합니다. 
                            단순히 열을 내리는 약만 쓰면 성질이 무거워 위로 올라가지 못합니다. 
                            방풍의 <strong>승산(升散)</strong>하는 힘을 빌려 서늘한 기운을 입 안까지 끌어올립니다.
                        </p>
                    </div>
                `
            },
            {
                id: 'yupingfengsan',
                name: '옥병풍산(玉屏風散)',
                targetArea: '피부(表), 위기(衛氣)',
                ingredients: '황기, 백출, <span class="font-bold text-emerald-600">방풍</span>',
                markerId: 'marker-skin',
                color: 'bg-sky-100 text-sky-800',
                btnColor: 'hover:bg-sky-50 hover:border-sky-200',
                icon: 'shield',
                coordinates: 'M 100 150 L 130 140', // Center to Skin/Surface
                description: '바람을 막는 옥(玉)으로 만든 병풍',
                detail: `
                    <h3 class="text-xl font-bold text-sky-700 mb-2">다한(多汗) & 잦은 감기</h3>
                    <p class="text-stone-600 mb-4"><strong>주 효능:</strong> 식은땀이 많이 나거나, 기허(氣虛)로 인해 외부의 사기(감기)에 쉽게 걸리는 체질을 보강합니다.</p>
                    <div class="bg-white p-4 rounded-lg border border-sky-100 shadow-sm">
                        <h4 class="font-bold text-sm text-stone-500 mb-1">방풍의 역할 (인경)</h4>
                        <p class="text-stone-800">
                            약기운을 <span class="text-sky-600 font-bold">피부 표면(表)</span>으로 이끌어 고표(固表)합니다.
                            황기가 기운을 보하면, 방풍은 그 기운이 밖으로 새나가지 않도록 피부 표면을 순찰하며 방어막을 칩니다.
                        </p>
                    </div>
                `
            },
            {
                id: 'tongxieyaofang',
                name: '통사요방(痛瀉要方)',
                targetArea: '소화기(간, 비)',
                ingredients: '백출, 백작약, 진피, <span class="font-bold text-emerald-600">방풍</span>',
                markerId: 'marker-abdomen',
                color: 'bg-emerald-100 text-emerald-800',
                btnColor: 'hover:bg-emerald-50 hover:border-emerald-200',
                icon: 'activity',
                coordinates: 'M 100 120 L 100 220', // Down to abdomen/soothing
                description: '아픈 설사를 멎게 하는 요긴한 처방',
                detail: `
                    <h3 class="text-xl font-bold text-emerald-700 mb-2">과민성 대장 & 스트레스 설사</h3>
                    <p class="text-stone-600 mb-4"><strong>주 효능:</strong> 급격한 복통을 동반하는 설사(급증). 스트레스로 인한 간울비허(肝鬱脾虛)를 다스립니다.</p>
                    <div class="bg-white p-4 rounded-lg border border-emerald-100 shadow-sm">
                        <h4 class="font-bold text-sm text-stone-500 mb-1">방풍의 역할 (인경)</h4>
                        <p class="text-stone-800">
                            약기운을 <span class="text-emerald-600 font-bold">소화기(장)</span> 계통으로 이끌어 습(濕)을 제거합니다.
                            방풍은 간(肝)의 억울된 기운을 흩어주고(발산), 비장(脾)의 습기를 말려 통증을 멈추게 합니다.
                        </p>
                    </div>
                `
            },
            {
                id: 'xiaofengsan',
                name: '소풍산(消風散)',
                targetArea: '전신 피부',
                ingredients: '형개, <span class="font-bold text-emerald-600">방풍</span>, 우방자, 선퇴, 당귀, 생지황, 고삼 등',
                markerId: 'marker-body',
                color: 'bg-pink-100 text-pink-800',
                btnColor: 'hover:bg-pink-50 hover:border-pink-200',
                icon: 'droplets',
                coordinates: 'M 100 150 C 60 150 70 140 70 140', // Spreading to skin
                description: '피부의 풍, 습, 열을 흩어버리다',
                detail: `
                    <h3 class="text-xl font-bold text-pink-700 mb-2">아토피, 습진, 두드러기</h3>
                    <p class="text-stone-600 mb-4"><strong>주 효능:</strong> 풍(風), 습(濕), 열(熱)이 복합되어 가렵고 진물이 나는 피부 질환을 치료합니다.</p>
                    <div class="bg-white p-4 rounded-lg border border-pink-100 shadow-sm">
                        <h4 class="font-bold text-sm text-stone-500 mb-1">방풍의 역할 (인경)</h4>
                        <p class="text-stone-800">
                            약기운을 <span class="text-pink-600 font-bold">피부와 기육</span> 사이로 이끌어냅니다.
                            피부에 갇혀 있는 습기와 열기를 방풍의 '발산'하는 힘으로 땀구멍을 열어 밖으로 배출시킵니다.
                        </p>
                    </div>
                `
            },
            {
                id: 'chuanxiong',
                name: '천궁다조산(川芎茶調散)',
                targetArea: '두면부(머리)',
                ingredients: '천궁, 형개, <span class="font-bold text-emerald-600">방풍</span>, 백지, 강활, 세신, 박하',
                markerId: 'marker-head',
                color: 'bg-indigo-100 text-indigo-800',
                btnColor: 'hover:bg-indigo-50 hover:border-indigo-200',
                icon: 'brain',
                coordinates: 'M 100 220 L 100 30', // Straight up to head
                description: '차와 함께 복용하여 머리를 맑게',
                detail: `
                    <h3 class="text-xl font-bold text-indigo-700 mb-2">두통 & 편두통</h3>
                    <p class="text-stone-600 mb-4"><strong>주 효능:</strong> 풍한(風寒)으로 인한 두통, 특히 머리가 깨질 듯 아프거나 찬 바람을 쐬면 심해지는 경우.</p>
                    <div class="bg-white p-4 rounded-lg border border-indigo-100 shadow-sm">
                        <h4 class="font-bold text-sm text-stone-500 mb-1">방풍의 역할 (인경)</h4>
                        <p class="text-stone-800">
                            약기운을 가장 높은 <span class="text-indigo-600 font-bold">머리와 얼굴(두면부)</span>로 힘차게 끌어올립니다(승청).
                            머리 꼭대기에 있는 풍사(나쁜 기운)를 제거하여 통증을 없앱니다.
                        </p>
                    </div>
                `
            }
        ];

        // Initialize Icons
        lucide.createIcons();

        // DOM Elements
        const listContainer = document.getElementById('prescriptionList');
        const infoContent = document.getElementById('info-content');
        const modal = document.getElementById('philosophyModal');
        const modalContent = document.getElementById('modalContent');
        const markers = document.querySelectorAll('.marker');
        const pathLine = document.getElementById('path-line');

        // Initial Render List
        prescriptions.forEach(p => {
            const btn = document.createElement('button');
            btn.className = `w-full text-left p-4 rounded-xl border border-stone-200 transition-all duration-200 bg-white shadow-sm flex items-start justify-between group ${p.btnColor}`;
            btn.onclick = () => selectPrescription(p.id);
            btn.innerHTML = `
                <div class="w-full pr-4">
                    <div class="flex flex-col md:flex-row md:items-center justify-between mb-1">
                        <span class="font-bold text-stone-700 text-lg group-hover:text-emerald-700 serif">${p.name}</span>
                        <span class="text-xs font-medium px-2 py-0.5 rounded bg-stone-100 text-stone-500 whitespace-nowrap md:ml-2 w-fit mt-1 md:mt-0">${p.targetArea}</span>
                    </div>
                    <div class="text-sm text-stone-500 mt-1 leading-snug">
                        ${p.ingredients}
                    </div>
                </div>
                <div class="flex-shrink-0 w-6 h-6 rounded-full bg-stone-100 flex items-center justify-center text-stone-400 group-hover:bg-white group-hover:text-emerald-600 transition-colors mt-1">
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </div>
            `;
            listContainer.appendChild(btn);
        });
        lucide.createIcons();

        function selectPrescription(id) {
            const data = prescriptions.find(p => p.id === id);
            if (!data) return;

            // 1. Update List UI (Active State)
            const buttons = listContainer.children;
            Array.from(buttons).forEach((btn, idx) => {
                if(prescriptions[idx].id === id) {
                    btn.classList.add('ring-2', 'ring-emerald-500', 'bg-emerald-50');
                    btn.classList.remove('bg-white');
                } else {
                    btn.classList.remove('ring-2', 'ring-emerald-500', 'bg-emerald-50');
                    btn.classList.add('bg-white');
                }
            });

            // 2. Update Info Content with Animation
            infoContent.classList.remove('animate-flow');
            void infoContent.offsetWidth; // trigger reflow
            infoContent.innerHTML = `
                <div class="inline-block px-3 py-1 rounded-full text-xs font-bold mb-4 ${data.color}">
                    ${data.targetArea}
                </div>
                <h2 class="text-3xl font-bold serif text-stone-800 mb-2">${data.name}</h2>
                <div class="mb-4 text-sm text-stone-500 border-b border-stone-100 pb-4">
                    <span class="font-bold mr-2 text-stone-600">구성 약재:</span> ${data.ingredients}
                </div>
                <p class="text-stone-500 italic mb-6 border-l-2 border-stone-300 pl-3">"${data.description}"</p>
                <div class="prose prose-stone">
                    ${data.detail}
                </div>
            `;
            infoContent.classList.add('animate-flow');

            // 3. Update Visual Markers
            markers.forEach(m => {
                m.classList.add('opacity-30', 'scale-75');
                m.classList.remove('opacity-100', 'scale-110');
            });
            const activeMarker = document.getElementById(data.markerId);
            if (activeMarker) {
                activeMarker.classList.remove('opacity-30', 'scale-75');
                activeMarker.classList.add('opacity-100', 'scale-110');
            }

            // 4. Draw/Animate Path
            if(pathLine) {
                pathLine.classList.add('hidden'); // hide first
                setTimeout(() => {
                    pathLine.setAttribute('d', data.coordinates);
                    pathLine.classList.remove('hidden');
                    pathLine.classList.remove('opacity-0');
                    
                    // Simple path animation trick
                    const length = pathLine.getTotalLength();
                    pathLine.style.strokeDasharray = length;
                    pathLine.style.strokeDashoffset = length;
                    pathLine.getBoundingClientRect(); // trigger layout
                    pathLine.style.transition = 'stroke-dashoffset 1s ease-out';
                    pathLine.style.strokeDashoffset = '0';
                }, 100);
            }
        }

        // Modal Logic
        function toggleInfoModal() {
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    modalContent.classList.remove('scale-95');
                    modalContent.classList.add('scale-100');
                }, 10);
            } else {
                modal.classList.add('opacity-0');
                modalContent.classList.remove('scale-100');
                modalContent.classList.add('scale-95');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
        }

        // Select first item on load
        // selectPrescription('sahuangsan'); 
        // Or keep welcome message. Let's keep welcome message for interaction incentive.
        lucide.createIcons();
    </script>
</body>
</html>
