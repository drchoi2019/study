<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fangfeng (Saposhnikoviae Radix): Beyond Releasing the Exterior</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif:wght@400;700&family=Noto+Sans:wght@300;400;500;700&display=swap');

        body {
            font-family: 'Noto Sans', sans-serif;
            background-color: #fdfbf7;
            /* Off-white background like Hanji */
            color: #2c3e50;
        }

        .serif {
            font-family: 'Noto Serif', serif;
        }

        /* Custom Animations */
        @keyframes float {
            0% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-5px);
            }

            100% {
                transform: translateY(0px);
            }
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.8);
                opacity: 0.5;
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
            }

            70% {
                transform: scale(1);
                opacity: 1;
                box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
            }

            100% {
                transform: scale(0.8);
                opacity: 0.5;
                box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
            }
        }

        @keyframes flowUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }

            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .animate-flow {
            animation: flowUp 0.6s ease-out forwards;
        }

        .marker-pulse::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            border-radius: 50%;
            animation: pulse-ring 2s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        /* Herb visual style */
        .herb-texture {
            background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%239C92AC' fill-opacity='0.1' fill-rule='evenodd'%3E%3Ccircle cx='3' cy='3' r='3'/%3E%3Ccircle cx='13' cy='13' r='3'/%3E%3C/g%3E%3C/svg%3E");
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .active-tab {
            border-bottom: 2px solid #059669;
            color: #059669;
            font-weight: 700;
        }

        .inactive-tab {
            color: #6b7280;
            border-bottom: 2px solid transparent;
        }

        .inactive-tab:hover {
            color: #374151;
        }
    </style>
</head>

<body class="min-h-screen flex flex-col herb-texture">

    <!-- Header -->
    <header class="w-full bg-white/90 backdrop-blur-sm border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div
                    class="w-10 h-10 bg-emerald-700 rounded-full flex items-center justify-center text-white font-bold serif text-xl shadow-lg">
                    防</div>
                <div>
                    <h1 class="text-xl md:text-2xl font-bold text-emerald-900 serif">Understanding Exterior-Releasing
                        Formulas</h1>
                    <p class="text-xs text-stone-500">Beyond Releasing the Exterior: Ascending Yang and Guiding to
                        Channels</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <a href="fangfeng_k.html"
                    class="px-3 py-1 bg-stone-100 text-stone-600 rounded-md text-sm font-bold hover:bg-stone-200 transition-colors">Korean</a>
                <button onclick="toggleInfoModal()"
                    class="hidden md:flex items-center gap-2 text-sm text-emerald-700 font-medium hover:bg-emerald-50 px-3 py-2 rounded-lg transition-colors">
                    <i data-lucide="book-open" class="w-4 h-4"></i>
                    Essence of Formula Science
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow max-w-6xl mx-auto w-full p-4 md:p-6 grid grid-cols-1 lg:grid-cols-12 gap-6">

        <!-- Left Column: Navigation & Concept (4 cols) -->
        <div class="lg:col-span-4 flex flex-col gap-4">
            <!-- Intro Card -->
            <div class="bg-white rounded-2xl p-6 shadow-sm border border-stone-100">
                <h2 class="text-lg font-bold text-stone-800 mb-2 flex items-center gap-2">
                    <i data-lucide="wind" class="text-emerald-500"></i>
                    Interpretation of Exterior-Releasing Agents
                </h2>
                <!-- Text Removed as requested -->

                <!-- Tab Navigation for Mobile (and Desktop List) -->
                <div class="flex flex-col gap-2 mt-4" id="prescriptionList">
                    <!-- Buttons generated by JS -->
                </div>
            </div>

            <!-- Mobile Only 'Philosophy' Button -->
            <button onclick="toggleInfoModal()"
                class="md:hidden w-full bg-stone-800 text-white p-4 rounded-xl shadow-lg flex justify-center items-center gap-2">
                <i data-lucide="lightbulb" class="w-5 h-5"></i>
                Read the Essence of Formula Science
            </button>
        </div>

        <!-- Right Column: Interactive Visual & Detail (8 cols) -->
        <div class="lg:col-span-8 flex flex-col gap-6 relative">

            <!-- Visualization Area -->
            <div class="bg-gradient-to-br from-white to-emerald-50/50 rounded-3xl shadow-xl border border-white relative overflow-hidden min-h-[500px] flex flex-col md:flex-row transition-all duration-500"
                id="mainDisplay">

                <!-- Human Silhouette & Markers -->
                <div class="w-full md:w-1/2 relative h-[400px] md:h-auto flex items-center justify-center p-8">
                    <!-- Body Shape (SVG) -->
                    <svg viewBox="0 0 200 400" class="h-full w-auto drop-shadow-2xl opacity-80">
                        <path
                            d="M100,20 C115,20 125,30 125,45 C125,55 120,60 115,65 L135,75 L130,140 L110,120 L110,220 L125,380 L75,380 L90,220 L90,120 L70,140 L65,75 L85,65 C80,60 75,55 75,45 C75,30 85,20 100,20 Z"
                            fill="#e5e7eb" stroke="#d1d5db" stroke-width="2" />
                    </svg>

                    <!-- Dynamic Markers (Absolute Positioned) -->
                    <!-- Head -->
                    <div id="marker-head"
                        class="marker absolute top-[12%] left-[50%] -translate-x-1/2 transition-all duration-500 opacity-30 scale-75">
                        <div
                            class="w-8 h-8 bg-red-400 rounded-full flex items-center justify-center text-white shadow-lg marker-pulse">
                            <i data-lucide="brain" class="w-4 h-4"></i>
                        </div>
                    </div>
                    <!-- Mouth -->
                    <div id="marker-mouth"
                        class="marker absolute top-[18%] left-[50%] -translate-x-1/2 transition-all duration-500 opacity-30 scale-75">
                        <div
                            class="w-8 h-8 bg-orange-400 rounded-full flex items-center justify-center text-white shadow-lg marker-pulse">
                            <i data-lucide="smile" class="w-4 h-4"></i>
                        </div>
                    </div>
                    <!-- Skin/Surface (Chest area but representing surface) -->
                    <div id="marker-skin"
                        class="marker absolute top-[30%] left-[65%] transition-all duration-500 opacity-30 scale-75">
                        <div
                            class="w-8 h-8 bg-sky-400 rounded-full flex items-center justify-center text-white shadow-lg marker-pulse">
                            <i data-lucide="shield" class="w-4 h-4"></i>
                        </div>
                    </div>
                    <!-- Abdomen -->
                    <div id="marker-abdomen"
                        class="marker absolute top-[45%] left-[50%] -translate-x-1/2 transition-all duration-500 opacity-30 scale-75">
                        <div
                            class="w-8 h-8 bg-emerald-500 rounded-full flex items-center justify-center text-white shadow-lg marker-pulse">
                            <i data-lucide="activity" class="w-4 h-4"></i>
                        </div>
                    </div>
                    <!-- General Body/Skin (Dermatology) -->
                    <div id="marker-body"
                        class="marker absolute top-[35%] left-[30%] transition-all duration-500 opacity-30 scale-75">
                        <div
                            class="w-8 h-8 bg-pink-400 rounded-full flex items-center justify-center text-white shadow-lg marker-pulse">
                            <i data-lucide="droplets" class="w-4 h-4"></i>
                        </div>
                    </div>

                    <!-- Energy Flow Arrows (SVG Overlay) -->
                    <svg id="energy-flow" class="absolute inset-0 w-full h-full pointer-events-none"
                        style="z-index: 10;">
                        <!-- Arrows will be drawn here dynamically or pre-set -->
                        <defs>
                            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto">
                                <polygon points="0 0, 10 3.5, 0 7" fill="#10b981" />
                            </marker>
                        </defs>
                        <!-- Dynamic Paths -->
                        <path id="path-line" d="" fill="none" stroke="#10b981" stroke-width="3" stroke-dasharray="10,5"
                            marker-end="url(#arrowhead)" class="hidden opacity-0 transition-opacity duration-500" />
                    </svg>
                </div>

                <!-- Info Panel -->
                <div
                    class="w-full md:w-1/2 p-6 md:p-8 flex flex-col justify-center bg-white/60 backdrop-blur-md border-t md:border-t-0 md:border-l border-white">
                    <div id="info-content" class="animate-flow">
                        <div
                            class="inline-block px-3 py-1 bg-emerald-100 text-emerald-800 rounded-full text-xs font-bold mb-4">
                            Please select a prescription
                        </div>
                        <h2 class="text-3xl font-bold serif text-stone-800 mb-4">Energy Flow of Fangfeng</h2>
                        <p class="text-stone-600 leading-relaxed">
                            Select a prescription from the left menu to see where Fangfeng guides the energy (Channel
                            Guiding) and what actions it performs.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Context Hint -->
            <div class="bg-yellow-50 border border-yellow-200 rounded-xl p-4 flex items-start gap-3">
                <i data-lucide="info" class="w-5 h-5 text-yellow-600 mt-1 flex-shrink-0"></i>
                <p class="text-sm text-yellow-800">
                    <strong>Point:</strong> Just because Fangfeng is included doesn't mean it's just a 'cold medicine'.
                    In each formula, Fangfeng combines with other herbs to deliver 'Ascending', 'Dispersing', and
                    'Protecting' energy to specific locations.
                </p>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="w-full text-center py-6 text-stone-400 text-xs font-light">
        © 2024 Hyungsuk Choi. All Rights Reserved.
    </footer>

    <!-- Modal for Philosophy (Hidden by default) -->
    <div id="philosophyModal"
        class="fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] hidden opacity-0 transition-opacity duration-300 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl transform scale-95 transition-transform duration-300"
            id="modalContent">
            <div class="p-6 md:p-8 relative">
                <button onclick="toggleInfoModal()"
                    class="absolute top-4 right-4 p-2 hover:bg-stone-100 rounded-full transition-colors">
                    <i data-lucide="x" class="w-6 h-6 text-stone-400"></i>
                </button>

                <h2 class="text-2xl font-bold serif text-stone-800 mb-6 flex items-center gap-2">
                    <span
                        class="w-8 h-8 bg-stone-800 text-white rounded-lg flex items-center justify-center text-sm">壹</span>
                    Essence of Formula Science: Combination of Herb Energies
                </h2>

                <div class="prose prose-stone max-w-none">
                    <div class="bg-stone-50 p-6 rounded-xl mb-6 border-l-4 border-stone-800">
                        <p class="font-bold text-stone-700 text-lg mb-2">"Exterior-Releasing Agent = Cold Medicine?"</p>
                        <p class="text-stone-600">
                            In modern formula textbooks, assuming that the presence of an exterior-releasing agent
                            implies a floating pulse and an exterior pattern is an overly simplistic interpretation that
                            overlooks the nature of each herb and the combination of its <strong>Energy (Qi)</strong>.
                        </p>
                    </div>

                    <h3 class="text-lg font-bold text-emerald-800 mb-2">Core Energy of Fangfeng</h3>
                    <ul class="space-y-3 mb-6">
                        <li class="flex items-start gap-3">
                            <i data-lucide="arrow-up-right" class="w-5 h-5 text-emerald-600 mt-1"></i>
                            <span class="text-stone-700"><strong>Ascending and Dispersing (Sheng San):</strong> The
                                power to lift upwards and scatter outwards.</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i data-lucide="shield-check" class="w-5 h-5 text-emerald-600 mt-1"></i>
                            <span class="text-stone-700"><strong>Expelling Wind (Qu Feng):</strong> The power to drive
                                out lingering pathogens (wind).</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i data-lucide="map-pin" class="w-5 h-5 text-emerald-600 mt-1"></i>
                            <span class="text-stone-700"><strong>Channel Guiding (Yin Jing):</strong> The technique of
                                guiding this energy to specific areas (skin, head, digestive system, mouth) in
                                combination with other herbs.</span>
                        </li>
                    </ul>

                    <p class="text-stone-600 leading-relaxed">
                        The true study of formulas is not just listing efficacies. It lies in understanding the Yang
                        nature of each herb and exploring how to combine these energies to maximize the effect.
                    </p>
                </div>

                <div class="mt-8 pt-6 border-t border-stone-100 flex justify-end">
                    <button onclick="toggleInfoModal()"
                        class="px-6 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-lg font-medium transition-colors">
                        Understood
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Data Source
        const prescriptions = [
            {
                id: 'sahuangsan',
                name: 'Xiehuang san',
                targetArea: 'Gums (Upper), Spleen/Stomach',
                ingredients: 'Shi Gao, Zhi Zi, <span class="font-bold text-emerald-600">Fang Feng</span>, Huo Xiang, Gan Cao',
                markerId: 'marker-mouth',
                color: 'bg-orange-100 text-orange-800',
                btnColor: 'hover:bg-orange-50 hover:border-orange-200',
                icon: 'smile',
                coordinates: 'M 100 220 C 100 180 100 100 100 65', // Abdomen to Mouth (Upward)
                description: 'Finding and extinguishing hidden heat in the Upper Jiao',
                detail: `
                    <h3 class="text-xl font-bold text-orange-700 mb-2">Gum Inflammation & Stomatitis</h3>
                    <p class="text-stone-600 mb-4"><strong>Main Efficacy:</strong> Treats latent fire-heat in the Spleen/Stomach, such as gum inflammation, bleeding, and bad breath.</p>
                    <div class="bg-white p-4 rounded-lg border border-orange-100 shadow-sm">
                        <h4 class="font-bold text-sm text-stone-500 mb-1">Role of Fangfeng (Channel Guiding)</h4>
                        <p class="text-stone-800">
                            Guides the medicinal energy to the <span class="text-orange-600 font-bold">upper oral cavity and gums</span>. 
                            Simply using heat-clearing herbs makes them too heavy to rise. 
                            Borrowing Fangfeng's <strong>Ascending and Dispersing</strong> power, it lifts the cool energy up to the mouth.
                        </p>
                    </div>
                `
            },
            {
                id: 'yupingfengsan',
                name: 'Yupingfeng san',
                targetArea: 'Skin (Exterior), Wei Qi',
                ingredients: 'Huang Qi, Bai Zhu, <span class="font-bold text-emerald-600">Fang Feng</span>',
                markerId: 'marker-skin',
                color: 'bg-sky-100 text-sky-800',
                btnColor: 'hover:bg-sky-50 hover:border-sky-200',
                icon: 'shield',
                coordinates: 'M 100 150 L 130 140', // Center to Skin/Surface
                description: 'Jade Screen that blocks the wind',
                detail: `
                    <h3 class="text-xl font-bold text-sky-700 mb-2">Hyperhidrosis & Frequent Colds</h3>
                    <p class="text-stone-600 mb-4"><strong>Main Efficacy:</strong> Reinforces the constitution for those who sweat spontaneously or easily catch colds due to Qi deficiency.</p>
                    <div class="bg-white p-4 rounded-lg border border-sky-100 shadow-sm">
                        <h4 class="font-bold text-sm text-stone-500 mb-1">Role of Fangfeng (Channel Guiding)</h4>
                        <p class="text-stone-800">
                            Guides the medicinal energy to the <span class="text-sky-600 font-bold">skin surface (Exterior)</span> to stabilize the exterior.
                            While Astragalus tonifies Qi, Fangfeng patrols the skin surface to prevent that energy from leaking out, creating a defensive barrier.
                        </p>
                    </div>
                `
            },
            {
                id: 'tongxieyaofang',
                name: 'Tongxie yaofang',
                targetArea: 'Digestive System (Liver, Spleen)',
                ingredients: 'Bai Zhu, Bai Shao, Chen Pi, <span class="font-bold text-emerald-600">Fang Feng</span>',
                markerId: 'marker-abdomen',
                color: 'bg-emerald-100 text-emerald-800',
                btnColor: 'hover:bg-emerald-50 hover:border-emerald-200',
                icon: 'activity',
                coordinates: 'M 100 120 L 100 220', // Down to abdomen/soothing
                description: 'Essential formula to stop painful diarrhea',
                detail: `
                    <h3 class="text-xl font-bold text-emerald-700 mb-2">IBS & Stress Diarrhea</h3>
                    <p class="text-stone-600 mb-4"><strong>Main Efficacy:</strong> Diarrhea accompanied by sudden abdominal pain. Treats Liver Stagnation and Spleen Deficiency caused by stress.</p>
                    <div class="bg-white p-4 rounded-lg border border-emerald-100 shadow-sm">
                        <h4 class="font-bold text-sm text-stone-500 mb-1">Role of Fangfeng (Channel Guiding)</h4>
                        <p class="text-stone-800">
                            Guides the medicinal energy to the <span class="text-emerald-600 font-bold">digestive (intestinal)</span> system to remove dampness.
                            Fangfeng disperses the stagnated energy of the Liver and dries the dampness of the Spleen to stop the pain.
                        </p>
                    </div>
                `
            },
            {
                id: 'xiaofeng san',
                name: 'Xiaofengsan',
                targetArea: 'Whole Body Skin',
                ingredients: 'Jing Jie, <span class="font-bold text-emerald-600">Fang Feng</span>, Niu Bang Zi, Chan Tui, Dang Gui, Sheng Di Huang, Ku Shen, etc.',
                markerId: 'marker-body',
                color: 'bg-pink-100 text-pink-800',
                btnColor: 'hover:bg-pink-50 hover:border-pink-200',
                icon: 'droplets',
                coordinates: 'M 100 150 C 60 150 70 140 70 140', // Spreading to skin
                description: 'Scattering Wind, Dampness, and Heat from the skin',
                detail: `
                    <h3 class="text-xl font-bold text-pink-700 mb-2">Atopy, Eczema, Urticaria</h3>
                    <p class="text-stone-600 mb-4"><strong>Main Efficacy:</strong> Treats skin diseases with itching and weeping caused by a combination of Wind, Dampness, and Heat.</p>
                    <div class="bg-white p-4 rounded-lg border border-pink-100 shadow-sm">
                        <h4 class="font-bold text-sm text-stone-500 mb-1">Role of Fangfeng (Channel Guiding)</h4>
                        <p class="text-stone-800">
                            Guides the medicinal energy to the space between <span class="text-pink-600 font-bold">skin and flesh</span>.
                            It uses Fangfeng's 'dispersing' power to open the pores and vent the dampness and heat trapped in the skin outwards.
                        </p>
                    </div>
                `
            },
            {
                id: 'chuanxiong',
                name: 'Chuanxiong chatiao san',
                targetArea: 'Head & Face',
                ingredients: 'Chuan Xiong, Jing Jie, <span class="font-bold text-emerald-600">Fang Feng</span>, Bai Zhi, Qiang Huo, Xi Xin, Bo He',
                markerId: 'marker-head',
                color: 'bg-indigo-100 text-indigo-800',
                btnColor: 'hover:bg-indigo-50 hover:border-indigo-200',
                icon: 'brain',
                coordinates: 'M 100 220 L 100 30', // Straight up to head
                description: 'Taken with tea to clear the head',
                detail: `
                    <h3 class="text-xl font-bold text-indigo-700 mb-2">Headache & Migraine</h3>
                    <p class="text-stone-600 mb-4"><strong>Main Efficacy:</strong> Headaches caused by Wind-Cold, especially splitting headaches or those worsened by cold wind.</p>
                    <div class="bg-white p-4 rounded-lg border border-indigo-100 shadow-sm">
                        <h4 class="font-bold text-sm text-stone-500 mb-1">Role of Fangfeng (Channel Guiding)</h4>
                        <p class="text-stone-800">
                            Powerfully lifts the medicinal energy to the highest point, the <span class="text-indigo-600 font-bold">Head and Face (Ascending Clear)</span>.
                            It removes the Wind pathogen from the top of the head to eliminate pain.
                        </p>
                    </div>
                `
            }
        ];

        // Initialize Icons
        lucide.createIcons();

        // DOM Elements
        const listContainer = document.getElementById('prescriptionList');
        const infoContent = document.getElementById('info-content');
        const modal = document.getElementById('philosophyModal');
        const modalContent = document.getElementById('modalContent');
        const markers = document.querySelectorAll('.marker');
        const pathLine = document.getElementById('path-line');

        // Initial Render List
        prescriptions.forEach(p => {
            const btn = document.createElement('button');
            btn.className = `w-full text-left p-4 rounded-xl border border-stone-200 transition-all duration-200 bg-white shadow-sm flex items-center justify-between group ${p.btnColor}`;
            btn.onclick = () => selectPrescription(p.id);
            btn.innerHTML = `
                <div class="w-full pr-4">
                    <div class="text-sm text-stone-700 leading-snug font-medium group-hover:text-emerald-700 transition-colors">
                        ${p.ingredients}
                    </div>
                </div>
                <div class="flex-shrink-0 w-6 h-6 rounded-full bg-stone-100 flex items-center justify-center text-stone-400 group-hover:bg-white group-hover:text-emerald-600 transition-colors">
                    <i data-lucide="chevron-right" class="w-4 h-4"></i>
                </div>
            `;
            listContainer.appendChild(btn);
        });
        lucide.createIcons();

        function selectPrescription(id) {
            const data = prescriptions.find(p => p.id === id);
            if (!data) return;

            // 1. Update List UI (Active State)
            const buttons = listContainer.children;
            Array.from(buttons).forEach((btn, idx) => {
                if (prescriptions[idx].id === id) {
                    btn.classList.add('ring-2', 'ring-emerald-500', 'bg-emerald-50');
                    btn.classList.remove('bg-white');
                } else {
                    btn.classList.remove('ring-2', 'ring-emerald-500', 'bg-emerald-50');
                    btn.classList.add('bg-white');
                }
            });

            // 2. Update Info Content with Animation
            infoContent.classList.remove('animate-flow');
            void infoContent.offsetWidth; // trigger reflow
            infoContent.innerHTML = `
                <div class="inline-block px-3 py-1 rounded-full text-xs font-bold mb-4 ${data.color}">
                    ${data.targetArea}
                </div>
                <h2 class="text-3xl font-bold serif text-stone-800 mb-2">${data.name}</h2>
                <div class="mb-4 text-sm text-stone-500 border-b border-stone-100 pb-4">
                    <span class="font-bold mr-2 text-stone-600">Ingredients:</span> ${data.ingredients}
                </div>
                <p class="text-stone-500 italic mb-6 border-l-2 border-stone-300 pl-3">"${data.description}"</p>
                <div class="prose prose-stone">
                    ${data.detail}
                </div>
            `;
            infoContent.classList.add('animate-flow');

            // 3. Update Visual Markers
            markers.forEach(m => {
                m.classList.add('opacity-30', 'scale-75');
                m.classList.remove('opacity-100', 'scale-110');
            });
            const activeMarker = document.getElementById(data.markerId);
            if (activeMarker) {
                activeMarker.classList.remove('opacity-30', 'scale-75');
                activeMarker.classList.add('opacity-100', 'scale-110');
            }

            // 4. Draw/Animate Path
            if (pathLine) {
                pathLine.classList.add('hidden'); // hide first
                setTimeout(() => {
                    pathLine.setAttribute('d', data.coordinates);
                    pathLine.classList.remove('hidden');
                    pathLine.classList.remove('opacity-0');

                    // Simple path animation trick
                    const length = pathLine.getTotalLength();
                    pathLine.style.strokeDasharray = length;
                    pathLine.style.strokeDashoffset = length;
                    pathLine.getBoundingClientRect(); // trigger layout
                    pathLine.style.transition = 'stroke-dashoffset 1s ease-out';
                    pathLine.style.strokeDashoffset = '0';
                }, 100);
            }
        }

        // Modal Logic
        function toggleInfoModal() {
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modal.classList.remove('opacity-0');
                    modalContent.classList.remove('scale-95');
                    modalContent.classList.add('scale-100');
                }, 10);
            } else {
                modal.classList.add('opacity-0');
                modalContent.classList.remove('scale-100');
                modalContent.classList.add('scale-95');
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            }
        }

        // Select first item on load
        // selectPrescription('sahuangsan'); 
        // Or keep welcome message. Let's keep welcome message for interaction incentive.
        lucide.createIcons();
    </script>
</body>

</html>
