function checkFiveInARowBonus(stack, stackIndex) {
            // Check all possible combinations of 5 consecutive marbles
            for (let i = 0; i <= stack.length - 5; i++) {
                const bonusSlice = stack.slice(i, i + 5);
                const firstCategory = bonusSlice[0].category;
                
                // Check if all 5 marbles are the same category and haven't been awarded yet
                const isBonus = bonusSlice.every(m => m.category === firstCategory && !m.bonusAwarded);
                
                if (isBonus) {
                    const now = Tone.now();
                    const melody = ["C5", "E5", "G5"];
                    melody.forEach((note, idx) => synth.triggerAttackRelease(note, "16n", now + idx * 0.15));

                    gameState.score += 100;
                    bonusSlice.forEach(m => m.bonusAwarded = true);
                    
                    showBonusModal();
                    
                    setTimeout(() => {
                        const marbleElements = [];
                        const stackEl = document.getElementById(`stack${stackIndex}`);
                        const allMarbleElsInStack = stackEl.querySelectorAll('.marble');

                        // Calculate DOM indices (marbles are displayed in reverse order)
                        const startIndexInDOM = stack.length - 1 - (i + 4);
                        const endIndexInDOM = stack.length - 1 - i;

                        for (let k = startIndexInDOM; k <= endIndexInDOM; k++) {
                            if (allMarbleElsInStack[k]) {
                                marbleElements.push(allMarbleElsInStack[k]);
                            }
                        }
                        
                        applySparkleEffect(marbleElements);
                        marbleElements.forEach((el, k) => {
                            el.classList.add('marble-bounce');
                            el.style.animationDelay = `${k * 0.1}s`;
                            setTimeout(() => {
                               el.classList.remove('marble-bounce');
                               el.style.animationDelay = '';
                            }, 1000); 
                        });
                    }, 50);

                    updateUI();
                    break;
                }
            }
        }
