<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog & Pig Poop Catching Game</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');

        body {
            margin: 0;
            padding: 0;
            background-color: #f0f8ff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            height: 100dvh;
            /* Mobile viewport fix */
            font-family: 'Fredoka One', cursive;
            overflow: hidden;
            touch-action: none;
            /* Prevent default touch actions like scrolling */
        }

        #game-container {
            width: 100%;
            max-width: 400px;
            height: 100%;
            max-height: 600px;
            aspect-ratio: 2/3;
            background: linear-gradient(to bottom, #87CEEB, #E0F7FA);
            /* Sky gradient */
            border: 8px solid #333;
            border-radius: 20px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            box-sizing: border-box;
            /* Include border in size */
        }

        #game-screen {
            width: 100%;
            height: 100%;
            position: relative;
        }

        /* Grass at the bottom */
        #game-screen::after {
            content: "";
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background-color: #4CAF50;
            border-top: 5px solid #388E3C;
            z-index: 5;
        }

        #dog {
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
            transition: left 0.2s linear;
            z-index: 10;
        }

        #pig {
            bottom: 30px;
            /* Adjusted for grass */
            left: 50%;
            transform: translateX(-50%);
            transition: left 0.1s linear;
            z-index: 10;
        }

        .poop {
            position: absolute;
            font-size: 30px;
            z-index: 8;
            filter: drop-shadow(2px 2px 2px rgba(0, 0, 0, 0.2));
        }

        #ui-layer {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            display: flex;
            justify-content: space-between;
            z-index: 20;
            color: #333;
            text-shadow: 2px 2px 0px #fff;
        }

        #score,
        #level {
            font-size: 24px;
            background: rgba(255, 255, 255, 0.8);
            padding: 5px 15px;
            border-radius: 15px;
            border: 2px solid #333;
        }

        #game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            display: none;
            z-index: 30;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 20px;
            border: 5px solid #FF5722;
            color: #333;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        #game-over h1 {
            color: #FF5722;
            margin-top: 0;
            text-shadow: 2px 2px 0px #333;
        }

        button {
            background: #FF5722;
            color: white;
            border: 3px solid #333;
            padding: 15px 30px;
            font-family: 'Fredoka One', cursive;
            font-size: 20px;
            cursor: pointer;
            margin-top: 20px;
            border-radius: 50px;
            transition: transform 0.1s;
        }

        button:hover {
            transform: scale(1.05);
            background: #F4511E;
        }

        button:active {
            transform: scale(0.95);
        }

        /* Mobile Controls */
        #controls {
            position: absolute;
            bottom: -80px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
        }
    </style>
</head>

<body>

    <div id="game-container">
        <div id="ui-layer">
            <div id="score">SCORE: 0</div>
            <div id="level">SPEED: 1</div>
        </div>

        <div id="game-screen">
            <img id="dog" src="dog.png" alt="Dog" style="width: 80px; height: 80px; position: absolute;">
            <img id="pig" src="pig.png" alt="Pig" style="width: 80px; height: 80px; position: absolute;">
        </div>

        <div id="game-over">
            <h1>GAME OVER</h1>
            <p>SCORE: <span id="final-score">0</span></p>
            <button onclick="resetGame()">RETRY</button>
        </div>
    </div>

    <script>
        const gameScreen = document.getElementById('game-screen');
        const dog = document.getElementById('dog');
        const pig = document.getElementById('pig');
        const scoreEl = document.getElementById('score');
        const levelEl = document.getElementById('level');
        const gameOverScreen = document.getElementById('game-over');
        const finalScoreEl = document.getElementById('final-score');

        let score = 0;
        let gameSpeed = 1.0; // Even slower start speed
        let spawnRate = 3000; // Even slower spawn rate
        let isGameOver = false;
        let animationId;
        let lastTime = 0;
        let poops = [];

        // Audio Context
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        const audioCtx = new AudioContext();

        const soundManager = {
            playCatch: () => {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);

                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.1);

                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

                osc.start();
                osc.stop(audioCtx.currentTime + 0.1);
            },
            playGameOver: () => {
                if (audioCtx.state === 'suspended') audioCtx.resume();
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);

                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(200, audioCtx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.5);

                gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);

                osc.start();
                osc.stop(audioCtx.currentTime + 0.5);
            }
        };

        // Positions (0-100 percentage)
        let dogPos = 50;
        let pigPos = 50;
        let dogDirection = 1; // 1: right, -1: left

        // Game Loop
        function gameLoop(timestamp) {
            if (isGameOver) return;

            if (!lastTime) lastTime = timestamp;
            const deltaTime = timestamp - lastTime;

            update(deltaTime);

            lastTime = timestamp;
            animationId = requestAnimationFrame(gameLoop);
        }

        function update(deltaTime) {
            // Move Dog randomly
            if (Math.random() < 0.02) {
                dogDirection *= -1;
            }
            dogPos += dogDirection * 0.5;
            if (dogPos < 10) { dogPos = 10; dogDirection = 1; }
            if (dogPos > 90) { dogPos = 90; dogDirection = -1; }
            dog.style.left = dogPos + '%';

            // Move Poops
            const poopsToRemove = [];
            poops.forEach((poopObj, index) => {
                poopObj.y += (gameSpeed * deltaTime) / 16; // Normalize to approx 60fps
                poopObj.el.style.top = poopObj.y + 'px';

                // Collision Detection
                const poopRect = poopObj.el.getBoundingClientRect();
                const pigRect = pig.getBoundingClientRect();

                // Check if caught
                if (
                    poopRect.bottom >= pigRect.top + 10 &&
                    poopRect.top <= pigRect.bottom &&
                    poopRect.right >= pigRect.left + 10 &&
                    poopRect.left <= pigRect.right - 10
                ) {
                    // Caught!
                    score++;
                    updateScore();
                    soundManager.playCatch();
                    poopObj.el.remove();
                    poopsToRemove.push(index);

                    // Visual feedback
                    pig.style.filter = "brightness(1.5)";
                    setTimeout(() => pig.style.filter = "none", 300);
                }
                // Missed (hit ground)
                else if (poopObj.y > gameScreen.clientHeight - 20) {
                    gameOver();
                }
            });

            // Remove caught poops
            for (let i = poopsToRemove.length - 1; i >= 0; i--) {
                poops.splice(poopsToRemove[i], 1);
            }
        }

        function spawnPoop() {
            if (isGameOver) return;

            const poopEl = document.createElement('div');
            poopEl.classList.add('poop');
            poopEl.textContent = 'ðŸ’©';
            poopEl.style.left = dogPos + '%'; // Spawn at current dog position
            poopEl.style.top = '50px';
            gameScreen.appendChild(poopEl);

            poops.push({
                el: poopEl,
                y: 50
            });

            // Increase difficulty
            let nextSpawn = spawnRate;
            if (score > 10) { gameSpeed = 2.0; nextSpawn = 2500; }
            if (score > 20) { gameSpeed = 3.0; nextSpawn = 2000; }
            if (score > 30) { gameSpeed = 4.0; nextSpawn = 1500; }
            if (score > 50) { gameSpeed = 5.0; nextSpawn = 1000; }

            levelEl.textContent = `SPEED: ${Math.floor(gameSpeed)}`;

            setTimeout(spawnPoop, nextSpawn);
        }

        function updateScore() {
            scoreEl.textContent = `SCORE: ${score}`;
        }

        function gameOver() {
            isGameOver = true;
            soundManager.playGameOver();
            cancelAnimationFrame(animationId);
            finalScoreEl.textContent = score;
            gameOverScreen.style.display = 'block';
            pig.style.opacity = "0.5";
        }

        function resetGame() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            isGameOver = false;
            score = 0;
            gameSpeed = 1.0;
            spawnRate = 3000;
            poops.forEach(p => p.el.remove());
            poops = [];
            updateScore();
            gameOverScreen.style.display = 'none';
            pig.style.opacity = "1";
            lastTime = 0;
            pigPos = 50;
            pig.style.left = pigPos + '%';

            spawnPoop();
            requestAnimationFrame(gameLoop);
        }

        // Controls
        document.addEventListener('keydown', (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume(); // Resume audio context on first interaction
            if (isGameOver) return;

            // Step-by-step movement (20% increments)
            if (e.key === 'ArrowLeft') {
                pigPos -= 20;
            } else if (e.key === 'ArrowRight') {
                pigPos += 20;
            }

            if (pigPos < 10) pigPos = 10;
            if (pigPos > 90) pigPos = 90;

            pig.style.left = pigPos + '%';
        });

        // Mobile Touch / Pointer Controls
        document.addEventListener('pointerdown', (e) => {
            if (audioCtx.state === 'suspended') audioCtx.resume();

            // Prevent default behavior only if it's not a button click
            if (e.target.tagName !== 'BUTTON') {
                e.preventDefault();
            }

            if (isGameOver) return;

            const touchX = e.clientX;
            const screenWidth = window.innerWidth;

            if (touchX < screenWidth / 2) {
                // Left side touch
                pigPos -= 20;
            } else {
                // Right side touch
                pigPos += 20;
            }

            if (pigPos < 10) pigPos = 10;
            if (pigPos > 90) pigPos = 90;

            pig.style.left = pigPos + '%';
        });

        // Start Game
        resetGame();

    </script>
</body>

</html>